webpackJsonp([2],[,,function(e,t,i){"use strict";function n(){return parseInt((Math.random()+"."+performance.now()).replace(/\./g,""),10)}var a=VFDeps.View,o=VFDeps.ViewSwitcher,s=i(0),r=i(8),l=i(9),c=i(30),d=i(28),u=i(32),h=i(31),m=i(27),p=i(25),g=i(29),v=i(23),f=i(42),y={};y.initializeController=function(){this.worker=new Worker("web-worker-build.js")},y.sendCommand=function(e,t,i){function a(e,t){function i(n){n.data.eventId===e&&(t(null,n.data.payload),o.removeEventListener("message",i))}return i}var o=this.worker,s={command:e,payload:t};i&&(s.eventId=n(),o.addEventListener("message",a(s.eventId,i),!1)),o.postMessage(s)};var w=a.extend(y,{_workerInit:!1,initialize:function(e){var t=this;t.initializeController(),t.model=t.model||new s({},{parent:t}),t.model.parent!==t&&(t.model.parent=t),t.worker.addEventListener("message",function(){t._workerInit||(t._workerInit=!0,t.sendCommand("resetLayers",{layers:t.model.layers.serialize()}),t.sendCommand("resetSignals",{signals:t.model.signals.serialize()}))},!1),t._bindLayerEvents(),t.model.set({signals:e.signals,layers:e.layers,midi:t.midiAccess}),t.listenTo(t.midiAccess,"midi",function(e,i){t.sendCommand({type:"midi",name:e,value:i})}),t._animate(),e.autoStart&&t.play();var i=t.model;v.import(e.mappings,i),t.el?t._attachSuggestionHelper():t.once("change:el",t._attachSuggestionHelper)},_bindLayerEvents:function(){var e=this;return e.listenTo(e.model.layers,"add",function(t){e.sendCommand("addLayer",{layer:t.serialize()})}),e.listenTo(e.model.layers,"remove",function(t){e.sendCommand("addLayer",{layerName:t.name})}),e.listenTo(e.model.layers,"change:layer",function(t){if(t){var i=t.changedAttributes();Object.keys(i).length||(i=t.serialize()),delete i.uiState,Object.keys(i).length&&e.sendCommand("updateLayer",{layer:i,layerName:t.name})}}),this},_animate:function(e){this.controllerSparkline&&this.controllerSparkline.update(1e3/(e-this.model.frametime-this.model.firstframetime)),this.audioSource&&this.audioSource.update(),this.playing&&(this.model.frametime=e-this.model.firstframetime,this.update()),this._arId=window.requestAnimationFrame(this._animate.bind(this))},update:function(){var e=this.audioSource.audioAnalyser,t=this.audioSource.audioFrequencyArray;e.getByteFrequencyData(t);var i=this.audioSource.audioTimeDomainArray;e.getByteTimeDomainData(i);var n={frametime:this.model.frametime,audio:{bufferLength:e.frequencyBinCount,frequency:t,timeDomain:i}};this.sendCommand("heartbeat",n)},derived:{computedStyle:{deps:["el"],fn:function(){return window.getComputedStyle(this.el)}}},children:{midiAccess:r},session:{playing:["boolean",!0,!1],broadcastId:["string",!0,"vfBus"],_arId:"number",currentDetails:"state"},play:function(){return this.playing=!0,this.model.firstframetime||(this.model.firstframetime=performance.now()),this},pause:function(){return this.playing=!1,this},stop:function(){return this.playing=!1,this.model.firstframetime=this.model.frametime=0,this},subviews:{MIDIAccess:{waitFor:"el",selector:".midi-access",prepareView:function(e){var t=new l({parent:this,el:e,model:this.midiAccess});return t}},leftBottom:{waitFor:"el",selector:".region-left-bottom",prepareView:function(e){var t=window.getComputedStyle(e);this.codeEditor=new p({parent:this}),this.audioSource=new m({audioAnalyser:this.audioAnalyser,parent:this,color:t.color}),this.mappingsView=new f({collection:v,parent:this,model:this.model});var i=new g({parent:this,el:e,currentView:this.mappingsView,tabs:[{name:"Mappings",view:this.mappingsView,pinned:!0,active:!0},{name:"Editor",view:this.codeEditor,pinned:!0},{name:"Audio",view:this.audioSource,pinned:!0}]});return i.el.classList.add("row"),this.listenTo(this.codeEditor,"change:original",function(){i.focusTabIndex(1)}),i}},controllerSparkline:{waitFor:"el",selector:".sparkline-controller",prepareView:function(e){var t=window.getComputedStyle(e),i=new h({parent:this,color:t.color,font:t.fontSize+" "+t.fontFamily.split(" ").pop()});return e.appendChild(i.el),i}},layersView:{waitFor:"el",selector:".layers",prepareView:function(e){var t=new d({collection:this.model.layers,parent:this,el:e});return t}},signalsView:{waitFor:"el",selector:".signals",prepareView:function(e){var t=new c({collection:this.model.signals,parent:this,el:e});return t}}},_attachSuggestionHelper:function(){this.suggestionHelper||(this.suggestionHelper=this.registerSubview(new u({parent:this})))},remove:function(){a.prototype.remove.apply(this,arguments)},bindings:{broadcastId:{selector:".control-screen",type:function(e,t){t&&(e.src="./screen.html#"+t)}},playing:[{type:"toggle",selector:'[name="play"]',invert:!0},{type:"toggle",selector:'[name="pause"]'}]},events:{'click [name="play"]':"play",'click [name="pause"]':"pause",'click [name="stop"]':"stop",'click [name="resize"]':"resizeScreen",'click [name="screen"]':"_openScreen"},_openScreen:function(){window.open("./screen.html#"+this.broadcastId,"screen","width=800,height=600,location=no")},addMultiMapping:function(e){this.mappingsView.mappings.add({targetModel:e.targetModel,targetProperty:e.targetProperty})},showDetails:function(e){if(e===this.currentDetails)return this;var t=this.leftBottom.tabs,i=this.mappingsView.collection.objectPath(e.model),n=t.get(i);return n?n.view=e:n=t.add({name:i,view:e}),this.leftBottom.focusTab(i),this},render:function(){var e=this;return this.renderWithTemplate(),this.cacheElements({jsHeapLimit:".heap-limit span",jsHeapTotal:".heap-total span",jsHeapUsed:".heap-used span",detailsEl:".details"}),this.detailsSwitcher=new o(this.detailsEl,{show:function(t){e.currentDetails=t}}),this},autoRender:!0,template:'<div class="controller rows"><div class="row columns gutter-horizontal header"><div class="column no-grow gutter-right">Visual Fiha</div><div class="column columns"><span class="column columns no-grow button-group"><button class="column gutter-horizontal" name="play"><span class="vfi-play"></span></button><button class="column gutter-horizontal" name="pause"><span class="vfi-pause"></span></button><button class="column gutter-horizontal" name="stop"><span class="vfi-stop"></span></button></span><div class="column columns gutter-horizontal no-grow"><button name="screen">Open screen</button></div><div class="column gutter-horizontal no-grow columns performance">Controller <span class="column sparkline-controller"></span></div></div></div><div class="row columns body"><div class="region-left column no-grow rows"><iframe class="region-left-top row grow-l control-screen"></iframe><div class="region-left-bottom row rows"></div></div><div class="region-right column rows settings"><div class="region-right-top row columns"><div class="column rows"><div class="row layers"></div></div><div class="column rows"><div class="row signals"></div></div></div><div class="region-right-bottom row no-grow columns"><div class="column midi-access"></div></div></div></div></div>'});e.exports=w},,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=VFDeps.View,a=i(21),o=n.extend({template:'<section class="default-layer-control"><header class="columns"><div class="column no-grow"><button class="active prop-toggle"></button></div><h3 class="column layer-name gutter-left" data-hook="name"></h3></header><div class="preview gutter-horizontal"></div><div class="mappings props"></div></section>',events:{mouseenter:"_highlight",mouseleave:"_highlight","click .remove-layer":"_removeLayer","click .active.prop-toggle":"_toggleActive","click .layer-name":"_showDetails"},_highlight:function(e){this.model.uiState="mouseenter"===e.type?"highlighted":""},_removeLayer:function(){this.model.collection.remove(this.model)},_toggleActive:function(){this.model.toggle("active")},_showDetails:function(){this.rootView.showDetails(new a({parent:this,model:this.model}))},bindings:{"model.uiState":{type:"class"},"model.active":[{type:"booleanClass",name:"disabled",invert:!0},{type:"booleanClass",selector:".active.prop-toggle",yes:"vfi-toggle-on",no:"vfi-toggle-off"}],"model.name":{hook:"name",type:"text"},"model.type":[{hook:"type",type:"text"},{type:"class"}]}});o.types={},e.exports=o},,,function(module,exports,__webpack_require__){"use strict";var View=window.VFDeps.View,AceEditor=View.extend({edit:function(e,t,i,n){this.editor||this.render(),this.set({model:e,targetProperty:t,targetName:n||(e.name||"")+t}),this.script=this.original,this.editor.setValue(this.original||i)},template:'<section class="row code-editor rows"><header><h3></h3></header><div class="ace-editor row grow-xl"></div><div class="ace-controls row no-grow gutter columns"><div class="column"></div><div class="column no-grow gutter-right"><button class="no" name="cancel">Cancel</button></div><div class="column gutter-left text-right"><button class="yes" name="apply">Apply</button></div></div></section>',session:{editor:"any",script:["string",!0,""],targetName:"string",targetProperty:"string"},derived:{original:{deps:["model","targetProperty"],fn:function(){return(this.model?this.model[this.targetProperty]||"":"").toString()}},changed:{deps:["original","script"],fn:function(){return this.original!=this.script}}},bindings:{targetName:"header>h3",changed:{type:"toggle",selector:"button"}},events:{"click [name=cancel]":"_handleCancel","click [name=apply]":"_handleApply"},_handleCancel:function(e){e.preventDefault(),this.model&&this.targetProperty&&this.editor&&this.editor.setValue(this.original)},_handleApply:function(evt){if(evt.preventDefault(),this.model&&this.targetProperty&&this.editor){try{eval("var fn = "+this.script+";")}catch(e){return void console.info("script error!",e.stack,e.message,e.line)}this.model.set(this.targetProperty,this.script),delete this._cache.changed,delete this._cache.original,this.model.trigger("change:"+this.targetProperty),this.trigger("change:changed"),this.trigger("change:original")}},render:function(){if(this.editor)return this;var e=this;e.renderWithTemplate();var t=e.editor=window.ace.edit(e.query(".ace-editor"));t.$blockScrolling=1/0,t.on("change",function(){e.set("script",t.getValue())}),t.setTheme("ace/theme/monokai"),t.setShowInvisibles();var i=t.getSession();return i.setMode("ace/mode/javascript"),i.setUseSoftTabs(!0),i.setTabSize(2),i.setUseWrapMode(!0),e.original&&t.setValue(e.original),this}});module.exports=AceEditor},function(e,t,i){"use strict";e.exports=VFDeps.View.extend({autoRender:!0,template:'<canvas width="200" height="200"></canvas>',session:{lineWidth:["number",!0,1],width:["number",!0,200],height:["number",!0,200],padding:["number",!0,2],color:["string",!0,"#000"]},bindings:{width:{type:"attribute",name:"width"},height:{type:"attribute",name:"height"}},derived:{ctx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}}},drawScales:function(){var e,t,i,n,a,o,s,r,l,c,d=this.ctx,u=.5*d.canvas.width,h=.5*d.canvas.height,m=Math.min(u,h)-20,p=2*Math.PI;for(d.globalAlpha=.5,e=0;e<360;e+=15)t=p/360*e-Math.PI,l=Math.cos(t),c=Math.sin(t),i=Math.round(u+l*(m/10)),n=Math.round(h+c*(m/10)),a=Math.round(u+l*(m-5)),o=Math.round(h+c*(m-5)),s=Math.round(u+l*m),r=Math.round(h+c*m),d.beginPath(),d.moveTo(i,n),d.lineTo(a,o),d.textAlign="center",s<u?d.textAlign="right":s>u&&(d.textAlign="left"),d.textBaseline="middle",r<h?d.textBaseline="bottom":r>h&&(d.textBaseline="top"),d.globalAlpha=1,d.fillText(e,s,r),d.globalAlpha=.5,d.stroke(),d.closePath();return d.globalAlpha=1,this},update:function(){if(!this.el)return this;var e=this.parent,t=this.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=t.strokeStyle=this.color;var i=e.audioAnalyser,n=i.frequencyBinCount;this.drawScales(n),t.fillStyle=t.strokeStyle=this.color;var a=e.audioFrequencyArray;i.getByteFrequencyData(a);var o=e.audioTimeDomainArray;i.getByteTimeDomainData(o);var s,r,l,c,d,u,h=.5*t.canvas.width,m=.5*t.canvas.height,p=Math.min(h,m)-20,g=2*Math.PI;for(t.strokeStyle="red",t.beginPath(),s=0;s<n;s++)r=g/n*s-Math.PI,l=p/100*(a[s]/2),d=Math.round(h+Math.cos(r)*l),u=Math.round(m+Math.sin(r)*l),t.lineTo(d,u);for(t.stroke(),t.strokeStyle="azure",t.beginPath(),s=0;s<n;s++)r=g/n*s-Math.PI,c=p/100*(o[s]/2),d=Math.round(h+Math.cos(r)*c),u=Math.round(m+Math.sin(r)*c),t.lineTo(d,u);return t.stroke(),this}})},function(e,t,i){"use strict";var n=VFDeps.View,a=i(26),o=n.extend({autoRender:!0,template:'<div class="column rows audio-source"><div class="row columns"><div class="column audio-monitor"></div><div class="column audio-controls"><label>MinDb: <input type="range" name="minDecibels" value="-90" min="-200" max="-11" step="1" /></label><label>MaxDb: <input type="range" name="maxDecibels" value="-10" min="-70" max="120" step="1" /></label><label>Smoothing: <input type="range" name="smoothingTimeConstant" min="0" max="1" value="0.85" step="0.01" /></label><label>FftSize: <select type="number" name="fftSize" value="32" step="2"><option value="32">32</option><option value="64">64</option><option value="128">128</option><option value="256">256</option><option value="1024">1024</option><option value="2048">2048</option></select></label></div></div></div>',initialize:function(){["minDecibels","maxDecibels","smoothingTimeConstant","fftSize"].forEach(function(e){this.on("change:"+e,function(){this.audioAnalyser&&(this.audioAnalyser[e]=this[e])})},this),this.listenToAndRun(this,"change:audioContext change:audioAnalyser",this.connectAudioSource)},session:{minDecibels:["number",!0,-90],maxDecibels:["number",!0,-10],smoothingTimeConstant:["number",!0,.85],fftSize:["number",!0,256]},derived:{audioContext:{deps:[],fn:function(){return new window.AudioContext}},audioAnalyser:{deps:["audioContext"],fn:function(){var e=this.audioContext.createAnalyser();return e.minDecibels=this.minDecibels,e.maxDecibels=this.maxDecibels,e.smoothingTimeConstant=this.smoothingTimeConstant,e.fftSize=this.fftSize,e}},audioFrequencyArray:{deps:["audioAnalyser","fftSize"],fn:function(){return new window.Uint8Array(this.audioAnalyser.frequencyBinCount)}},audioTimeDomainArray:{deps:["audioAnalyser","fftSize"],fn:function(){return new window.Uint8Array(this.audioAnalyser.frequencyBinCount)}}},bindings:{minDecibels:{selector:'[name="minDecibels"]',type:"value"},maxDecibels:{selector:'[name="maxDecibels"]',type:"value"},smoothingTimeConstant:{selector:'[name="smoothingTimeConstant"]',type:"value"},fftSize:{selector:'[name="fftSize"]',type:"value"}},subviews:{monitor:{waitFor:"el",selector:".audio-monitor",prepareView:function(e){var t=new a({audioAnalyser:this.audioAnalyser,parent:this});return e.appendChild(t.el),t}}},events:{"change .audio-source [name]":"_changeAudioParams"},connectAudioSource:function(){function e(e){var t=i.audioContext.createMediaStreamSource(e);t.connect(i.audioAnalyser)}function t(e){console.warn(e)}var i=this,n={audio:!0};return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(n).then(e).catch(t):navigator.getUserMedia&&navigator.getUserMedia(n,e,t),this},_changeAudioParams:function(e){this.set(e.target.name,Number(e.target.value))},update:function(){this.monitor&&this.monitor.update()}});e.exports=o},function(e,t,i){"use strict";var n=VFDeps.View,a=i(22);i(33);var o=n.extend({autoRender:!0,events:{'click [name="add-layer"]':"_addLayer",'focus [data-hook="layer-type"]':"_suggestLayerType"},_suggestLayerType:function(){var e=this.parent.suggestionHelper,t=this.queryByHook("layer-type");e.attach(t,function(i){t.value=i,e.detach()}).fill(["default","img","SVG","canvas"])},_addLayer:function(){var e=this.queryByHook("signal-type"),t=this.queryByHook("signal-name"),i=e.value,n=t.value;i&&n&&(this.model.layers.add({name:n,type:i}),e.value=t.value="")},subviews:{items:{selector:".items",waitFor:"el",prepareView:function(e){return this.renderCollection(this.collection,function(e){var t=e.model.getType(),i=a.types[t]||a;return new i(e)},e)}}},template:'<div class="row layers"><div class="section-name gutter-vertical">Layers</div><div class="columns"><div class="column"><input data-hook="layer-name" placeholder="Name" type="text"/></div><div class="column"><input data-hook="layer-type" placeholder="Type" type="text"/></div><div class="column no-grow"><button name="add-layer" class="vfi-plus"></button></div></div><div class="items"></div></div>',render:function(){return this.rendered||this.renderWithTemplate(),this}});e.exports=o},function(e,t,i){"use strict";var n=VFDeps.State,a=VFDeps.View,o=VFDeps.Collection,s=VFDeps.ViewSwitcher,r=a.extend({template:'<li class="columns"><div class="column gutter name"></div><div class="column no-grow"><button class="vfi-minus-squared-alt"></button></div></li>',bindings:{"model.name":".name","model.active":{type:"booleanClass",name:"active"},"model.pinned":{type:"toggle",selector:"button",invert:!0}},events:{"click .name":"selectTab","click button":"closeTab"},selectTab:function(){var e=this,t=e.model;t.active||(t.collection.forEach(function(e){e.active=t===e}),e.parent.currentView=t.view)},closeTab:function(){this.parent.focusTabIndex(0),this.model.collection.remove(this.model)}}),l=a.extend({session:{currentView:"state"},collections:{tabs:o.extend({mainIndex:"name",find:function(e){for(var t=0;t<this.length;t++)if(e(this.models[t]))return this.models[t]},model:n.extend({idAttribute:"name",session:{pinned:"boolean",active:"boolean",name:"string",view:"state"}})})},initialize:function(){this.listenToAndRun(this,"change:currentView",function(){this.currentView&&this.render().regionSwitcher.set(this.currentView)})},autoRender:!0,template:'<div class="region"><ul class="region-tabs tabs"></ul><div class="region-content"></div></div>',render:function(){if(this.rendered)return this;this.renderWithTemplate();var e={show:function(e){var t=e.constructor.prototype.bindings||{};Object.keys(t).forEach(function(t){e.trigger("change:"+t)},e)}};return this.currentView&&(e.view=this.currentView),this.regionSwitcher=new s(this.query(".region-content"),e),this.renderCollection(this.tabs,r,".region-tabs"),this},_focus:function(e){e&&!e.active&&(e.collection.forEach(function(t){t.active=e===t}),this.currentView=e.view,e.view.trigger("change:model"))},focusTabIndex:function(e){this._focus(this.tabs.at(e))},focusTab:function(e){this._focus(this.tabs.get(e))}});e.exports=l},function(e,t,i){"use strict";var n=VFDeps.View,a=i(6);i(10),i(7),i(11);var o=n.extend({autoRender:!0,events:{'click [name="add-signal"]':"_addSignal",'focus [data-hook="signal-type"]':"_suggestSignalType"},_suggestSignalType:function(){var e=this.parent.suggestionHelper,t=this.queryByHook("signal-type");e.attach(this.queryByHook("signal-type"),function(i){t.value=i,e.detach()}).fill(["default","beatSignal","hslaSignal","rgbaSignal"])},_addSignal:function(){var e=this.queryByHook("signal-type"),t=this.queryByHook("signal-name"),i=e.value,n=t.value;i&&n&&(this.model.signals.add({name:n,type:i}),e.value=t.value="")},subviews:{items:{selector:".items",waitFor:"el",prepareView:function(e){return this.renderCollection(this.collection,function(e){var t=e.model.getType(),i=a.types[t]||a;return new i(e)},e)}}},template:'<div class="row signals"><div class="section-name gutter-vertical">Signals</div><div class="columns"><div class="column"><input data-hook="signal-name" placeholder="Name" type="text"/></div><div class="column"><input data-hook="signal-type" placeholder="Type" type="text"/></div><div class="column no-grow"><button name="add-signal" class="vfi-plus"></button></div></div><div class="items"></div></div>',render:function(){return this.rendered||this.renderWithTemplate(),this}});e.exports=o},function(e,t,i){"use strict";e.exports=VFDeps.View.extend({autoRender:!0,template:'<canvas width="120" height="29"></canvas>',session:{data:["array",!0,function(){return[]}],lineWidth:["number",!0,1],width:["number",!0,120],height:["number",!0,29],padding:["number",!0,2],color:["string",!0,"#000"],font:["string",!0,"11px sans"]},bindings:{width:{type:"attribute",name:"width"},height:{type:"attribute",name:"height"}},derived:{ctx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}},innerW:{deps:["el","width"],fn:function(){return this.el.width-2*this.lineWidth}},innerH:{deps:["el","height"],fn:function(){return this.el.height-2*this.lineWidth}}},max:function(){var e=0;return this.data.length?(this.data.forEach(function(t){e=Math.max(t,e)}),e):e},min:function(){var e=this.max();return this.data.length?(this.data.forEach(function(t){e=Math.min(t,e)}),e):e},avg:function(){var e=0;return this.data.length?(this.data.forEach(function(t){e+=t}),e/this.data.length):e},update:function(e){function t(e){return l/o*e+s}if(!this.el)return this;var i=this.lineWidth,n=this.ctx,a=this.avg(),o=this.max(),s=2*i,r=this.innerW,l=this.innerH,c=Math.round(r/2);"undefined"!=typeof e&&(this.data.unshift(e),this.data.length>c&&(this.data=this.data.slice(0,-1)));var d=r/(this.data.length-1);n.clearRect(0,0,this.width,this.height),n.font=this.font,n.lineWidth=i,n.lineCap="round",n.lineJoin="round",n.strokeStyle=this.color,n.moveTo(r+s,t(this.data[0])),n.beginPath(),this.data.forEach(function(e,i){var a=r-d*i+s,o=t(e);n.lineTo(a,o)});var u=this.data[0]||0;return n.stroke(),n.beginPath(),n.fillStyle=this.color,n.arc(r+s,t(u),2*i,0,2*Math.PI),n.fill(),n.beginPath(),n.moveTo(s,t(a)),n.lineTo(s+r,t(a)),n.stroke(),u=Math.round(100*a)/100,n.textBaseline="middle",n.textAlign="left",n.clearRect(0,s,n.measureText(u).width+2*s,n.canvas.height-s),n.fillText(u,s,.5*n.canvas.height),this}})},function(e,t,i){"use strict";function n(e){for(var t=e.concat().sort(),i=t[0],n=t[t.length-1],a=i.length,o=0;o<a&&i.charAt(o)===n.charAt(o);)o++;return i.substring(0,o)}var a=VFDeps.View,o=VFDeps.Collection,s=VFDeps.State,r=a.extend({template:"<li></li>",derived:{shortText:{deps:["model.text","model.collection.parent"],fn:function(){return this.model.text.substring(this.model.collection.parent.commonStart.length)}}},bindings:{shortText:{type:"text"}},events:{click:"_handleClick"},_handleClick:function(e){e.preventDefault(),this.parent.trigger("selected",this.model.value||this.model.text)}}),l=a.extend({autoRender:!0,attach:function(e,t,i){return this.inputEl="string"==typeof e?this.parent.query(e):e,t=t||function(e){this.inputEl.value=e,this.detach()}.bind(this),this.off("selected"),this.once("selected",t),this._makeHintEl(),i&&(i.isCollection?this.collection=i:this.collection.reset(i)),this.filterCollection(),this},fill:function(e){return this.collection.reset(e.map(function(e){return{text:e}})),this.filterCollection()},detach:function(){return this._removeHintEl(),this.off("selected"),this.unset("inputEl"),this.collection.reset([]),this},filterCollection:function(){var e=[];if(this.inputEl){var t=this.inputEl.value||this.inputEl.value;e=t?this.collection.filter(function(e){return 0===e.text.indexOf(t)}):this.collection.models}else e=this.collection.models;return e.length>1?this.commonStart=n(e.map(function(e){return e.text})):e.length?this.commonStart=e[0].text:this.commonStart="",this.suggestions.reset(e),this},derived:{_handleHintClick:{deps:[],fn:function(){var e=this;return function(){e.inputEl&&e.commonStart&&(e.inputEl.value=e.commonStart)}}},styles:{deps:["inputEl"],fn:function(){return this.inputEl?window.getComputedStyle(this.inputEl):{}}}},session:{commonStart:"string",inputEl:"element"},bindings:{commonStart:{type:function(){var e=this.suggestionHint;e&&(e.textContent=this.commonStart)}}},_handleInput:function(e){if("keydown"===e.type&&"Tab"===e.key&&this.commonStart!==this.inputEl.value&&e.preventDefault(),"keyup"!==e.type)return this.filterCollection();switch(e.key){case"ArrowRight":case"Tab":this._handleHintClick();break;case"ArrowUp":case"ArrowDown":console.info("suggestion input %s %s",e.type,e.key);break;default:this.filterCollection()}},_makeHintEl:function(){var e=this.inputEl.parentNode;if(!e)return this;this._removeHintEl();var t=this.suggestionHint=document.createElement("div");t.className="suggestion--hint",["display","paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","marginLeft","marginRight","top","bottom","left","right","borderWidth","borderStyle","lineHeight","fontSize","fontFamily","textAlign","color"].forEach(function(e){t.style[e]=this.styles[e]},this),t.style.cursor="pointer",t.style.pointerEvents="none",t.style.borderColor="transparent",t.style.position="absolute",t.style.zIndex=this.styles.zIndex+1,t.style.opacity=.5,e.appendChild(t),this.inputEl.addEventListener("click",this._handleHintClick)},_removeHintEl:function(){return this.suggestionHint&&this.suggestionHint.parentNode?(this.inputEl.removeEventListener("click",this._handleHintClick),this.suggestionHint.parentNode.removeChild(this.suggestionHint),this.suggestionHint=null,this):this},resetPosition:function(){var e=this;return e.el&&e.el.parentNode&&e.inputEl?(e.el.style.visibility="hidden",setTimeout(function(){if(e.el&&e.el.parentNode&&e.inputEl){var t=e.inputEl.getBoundingClientRect(),i=e.el.getBoundingClientRect();t.top>.5*e.el.parentNode.clientHeight?(e.el.style.maxHeight=Math.min(t.top,.33*e.el.parentNode.clientHeight)+"px",e.el.style.top=t.top-e.el.clientHeight-3+"px"):(e.el.style.maxHeight=Math.min(t.bottom,.33*e.el.parentNode.clientHeight)+"px",e.el.style.top=t.bottom+3+"px");var n=window.getComputedStyle(e.inputEl),a=e.el.parentNode&&i.left+i.width>e.el.parentNode.clientWidth;e.el.style.textAlign=n.textAlign,"right"===n.textAlign||a?e.el.style.left=t.left-(i.width-t.width)+"px":e.el.style.left=t.left+"px",e.el.style.visibility="visible"}}),e):e},initialize:function(){if(!this.parent)throw new Error("Suggestion view need a parent view");this.collection=this.collection||new o([],{parent:this}),this.on("change:collection",function(){this.listenToAndRun(this.collection,"add remove reset",this.filterCollection)}),this.listenTo(this.suggestions,"add remove reset",this.resetPosition);var e=this._handleInput.bind(this);this.on("change:inputEl",function(){var t=this.previousAttributes();t.inputEl&&(t.inputEl.removeEventListener("keydown",e),t.inputEl.removeEventListener("keyup",e));var i=this.el,n=this.parent.el,a=this.inputEl;if(!a)return void(this.el&&this.el.parentNode===n&&n.removeChild(this.el));if(i&&n){if(i.parentNode!==n){var o=window.getComputedStyle(n);"static"===o.position&&(n.style.position="relative"),n.appendChild(i)}this.resetPosition(),a.addEventListener("keydown",e,!1),a.addEventListener("keyup",e,!1)}});var t=function(e){e.preventDefault(),e.target===this.inputEl||this.el.contains(e.target)||this.detach()}.bind(this);this.listenToAndRun(this.parent,"change:el",function(){var e=this.parent.previousAttributes();e.el&&e.el.removeEventListener("click",t),this.parent.el&&this.parent.el.addEventListener("click",t,!1)})},collections:{suggestions:o.extend({model:s.extend({props:{text:["string",!0,""],value:["any",!1,null]}})})},template:'<ul class="suggestion-view"></ul>',render:function(){return this.renderWithTemplate(),this.items=this.renderCollection(this.suggestions,r,this.el),this}});e.exports=l},function(e,t,i){"use strict";var n=i(22),a=(i(21),VFDeps.View,VFDeps.assign),o=n.extend({template:'<section class="canvas-layer"><header class="columns"><div class="column no-grow"><button name="active"></button></div><div class="column no-grow"><button class="edit-draw-function vfi-cog-alt"></button></div><h3 class="column canvas-layer-name gutter-horizontal" data-hook="name"></h3><div class="column no-grow text-right"><button class="vfi-trash-empty remove-canvas-layer"></button></div></header></section>',derived:{codeEditor:{deps:["rootView"],fn:function(){return this.rootView.codeEditor}}},events:{mouseenter:"_highlight",mouseleave:"_highlight","click .remove-canvas-layer":"_removeLayer","click .edit-draw-function":"_editDrawFunction",'click [name="active"]':"_toggleActive","click .canvas-layer-name":"_showDetails"},_editDrawFunction:function(){var e=this.codeEditor;e.changed?console.warn("A function is already being edited"):e.edit(this.model,"drawFunction")},bindings:{"model.uiState":{type:"class"},"model.active":[{type:"booleanClass",name:"disabled",invert:!0},{type:"booleanClass",selector:'[name="active"]',yes:"vfi-toggle-on",no:"vfi-toggle-off"}],drawFunction:"[data-hook=drawFunction]","model.name":"[data-hook=name]","model.duration":"[data-hook=duration]","model.fps":"[data-hook=fps]","model.frametime":"[data-hook=frametime]"}});e.exports=n.types.canvas=n.extend({template:'<section class="row canvas-control"><header class="rows"><div class="row columns"><div class="column no-grow"><button class="active prop-toggle"></button></div><h3 class="column layer-name" data-hook="name"></h3></div><div class="row columns new-layer"><div class="column"><input type="text" placeholder="new-layer-name" data-hook="new-layer-name" /></div><div class="column"><input type="text" placeholder="propA, propB" data-hook="new-layer-props" /></div><div class="column no-grow"><button name="add-layer" class="vfi-plus"></button></div></div></header><div class="layers"><div class="items"></div></div></section>',events:a({"change [data-hook=new-layer-name]":"_inputLayerName","click [name=add-layer]":"_addLayer"},n.prototype.events),_inputLayerName:function(){this.query("[name=add-layer]").disabled=!this.queryByHook("new-layer-name").value.trim()},_addLayer:function(e){e.preventDefault();var t=this.queryByHook("new-layer-name"),i=t.value.trim(),n=this.queryByHook("new-layer-props"),a=n?n.value.split(",").map(function(e){return e.trim()}).filter(function(e){return e}):[],o={};a.forEach(function(e){o[e]="any"});var s=this.model.canvasLayers.add({name:i,drawFunction:"function(ctx) {\n  // "+i+" drawFunction\n}",props:o});if(!s)return void console.warn("new layer?",s);t.value="";var r=this.model.canvasLayersView.views.find(function(e){return e.model===s});r.codeEditor.changed||r.codeEditor.edit(s,"drawFunction")},initialize:function(){this.once("change:rendered",this._inputLayerName)},subviews:{canvasLayersView:{waitFor:"el",selector:".layers .items",prepareView:function(e){return this.renderCollection(this.model.canvasLayers,o,e)}}}})},,,,,,,,,function(e,t,i){"use strict";var n=VFDeps.View,a=n.extend({template:'<div class="columns"><div class="column no-grow"><button class="remove vfi-trash-empty"></button></div><div class="column source-path"><input type="text" name="source-path" /></div><div class="column gutter-vertical no-grow">&raquo;</div><div class="column no-grow"><button class="edit-transform-function vfi-cog-alt"></button></div><div class="column gutter-vertical no-grow">&raquo;</div><div class="column target-path"><input type="text" name="target-path" /></div></div>',derived:{codeEditor:{deps:["rootView"],fn:function(){return this.rootView.codeEditor}},suggestionHelper:{deps:["rootView"],fn:function(){return this.rootView.suggestionHelper}}},bindings:{"model.uiState":{type:"class"},"model.sourcePath":{type:"value",selector:"[name=source-path]"},"model.targetPath":{type:"value",selector:"[name=target-path]"}},events:{"focus [name=source-path]":"_handleSourcePathFocus","focus [name=target-path]":"_handleTargetPathFocus","blur [name=source-path]":"_handlePathBlur","blur [name=target-path]":"_handlePathBlur","click .remove":"_handleRemove","click .edit-transform-function":"_handleEditTransformFunction","change [name=target-path]":"_handleTargetPathChange"},_handleSourcePathFocus:function(e){var t=this.suggestionHelper,i=this.parent.model,n=this.model;t.attach(e.target,function(a){n.updateInfo("source",a,i),e.target.value=a,t.detach()}).fill(this.collection.sourceSuggestions(i))},_handleTargetPathFocus:function(e){var t=this.suggestionHelper,i=this.parent.model,n=this.model;t.attach(e.target,function(a){n.updateInfo("target",a,i),e.target.value=a,t.detach()}).fill(this.collection.targetSuggestions(i))},_handlePathBlur:function(e){e.preventDefault()},_handleRemove:function(){this.model.collection.remove(this.model)},_handleEditTransformFunction:function(){var e=this.codeEditor;e.changed?console.warn("A function is already being edited"):e.edit(this.model,"transformation","function transform(val) {\n  return val;\n}",this.model.targetPath);
},_handleTargetPathChange:function(e){console.info(e)}}),o=n.extend({template:'<section class="mappings-view"><header><div class="add-form columns"><div class="column add-form--source-path"><input placeholder="Source" name="new-source-path" /></div><div class="column gutter no-grow">&raquo;</div><div class="column add-form--target-path"><input placeholder="Target" name="new-target-path" /></div><div class="column no-grow"><button name="add-mapping">Add</button></div></div></header><div class="items"></div></section>',validatePath:function(e){return"undefined"!=typeof this.collection.resolve(e,this.model)},subviews:{mappingsList:{waitFor:"collection",selector:".items",prepareView:function(e){return this.renderCollection(this.collection,a,e)}}},derived:{suggestionHelper:{deps:["rootView"],fn:function(){return this.rootView.suggestionHelper}}},events:{"focus [name=new-source-path]":"_handleSourceFocus","focus [name=new-target-path]":"_handleTargetFocus",'click [name="add-mapping"]':"_handleAddMapping"},_handleSourceFocus:function(e){var t=this.suggestionHelper;t.attach(e.target,function(i){e.target.value=i,t.detach()}).fill(this.collection.sourceSuggestions(this.model))},_handleTargetFocus:function(e){var t=this.suggestionHelper;t.attach(e.target,function(i){e.target.value=i,t.detach()}).fill(this.collection.targetSuggestions(this.model))},_handleAddMapping:function(e){e.preventDefault();var t=this.query('[name="new-source-path"]'),i=this.query('[name="new-target-path"]');return this.validatePath(t.value)?i.value&&!this.validatePath(i.value)?void console.warn('"%s" cannot be used as target path',i.value):(this.collection.import([{source:t.value,target:i.value}],this.model),t.value="",void(i.value="")):void console.warn('"%s" cannot be used as source path',t.value)}});e.exports=o}]);
//# sourceMappingURL=2-build.js.map