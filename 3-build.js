webpackJsonp([3],{13:function(e,t,i){"use strict";var n=window.VFDeps.View,s=n.extend({template:function(){return'<div layer-id="'+this.model.cid+'" view-id="'+this.cid+'" class="missing-layer-view" style="will-change:transform, opacity, backfaceVisibility;width:100%;height:100%;display:table"><div style="display:table-cell;color:#a66;vertical-align:middle;text-align:center;font-weight:700;font-size:30px;text-shadow:0 0 4px #000">Missing <span data-hook="type"></span> for <span data-hook="name"></span> layer view<br/><span data-hook="frametime"></span> </div></div>'},derived:{style:{deps:["model.active","model.opacity","model.skewX","model.skewY","model.rotateX","model.rotateY","model.rotateZ","model.translateX","model.translateY","model.scaleX","model.scaleY","model.originX","model.originY","model.backfaceVisibility","model.mixBlendMode","model.zIndex"],fn:function(){var e=this.el.parentNode?this.el.parentNode.clientWidth+"px":"100%",t=this.el.parentNode?this.el.parentNode.clientHeight+"px":"100%";return{display:this.model.active?"block":"none",opacity:.01*this.model.opacity,mixBlendMode:this.model.mixBlendMode,width:e,height:t,zIndex:this.zIndex||0,perspective:this.model.perspective+"px"}}},styleEl:{deps:["el"],fn:function(){var e=document.getElementById("style-"+this.cid);return e||(e=document.createElement("style"),e.id="style-"+this.cid,e.appendChild(document.createTextNode("")),document.head.appendChild(e)),e}},sheet:{deps:["styleEl"],fn:function(){return this.styleEl.sheet}},cssRule:{deps:["sheet"],fn:function(){return 0===this.sheet.cssRules.length&&this.addRule("","display: none"),this.sheet.cssRules[0]}}},session:{width:["number",!0,400],height:["number",!0,300]},bindings:{"model.type":"[data-hook=type]","model.name":"[data-hook=name]",style:{type:function(){var e=this.cssRule.style,t=this.style;Object.keys(t).forEach(function(i){e[i]=t[i]})}}},addRule:function(e,t,i){var n=this.sheet,s='[view-id="'+this.cid+'"] ';i=i||0,"insertRule"in n?n.insertRule(s+e+" { "+t+" } ",i):"addRule"in n&&n.addRule(s+e,t,i)},remove:function(){var e=this.styleEl;e&&e.parentNode&&e.parentNode.removeChild(e),n.prototype.remove.apply(this,arguments)},update:function(){}});e.exports=s},2:function(e,t,i){"use strict";function n(e){var t=e.toString().match("function[^(]*\\(([^)]*)\\)");return t&&t[1].trim()?t[1].split(",").map(function(e){return e.trim()}):[]}function s(e,t){1===arguments.length?"function"==typeof arguments[0]?(t=arguments[0],e=t.name):t=d[arguments[0]]:"function"!=typeof t&&(t=d[e]),o[e]=n(t)}var a=window.VFDeps.View,r=i(13);i(36),i(38),i(39),i(37);var o={},d={};d.setup=function(e){this.update(e)},d.resetLayers=function(e){function t(t){return e.find(function(){return function(e){return e.name===t}})}var i,n=this.model.layers;e.forEach(function(e){i=!0;var t=n.get(e.name);t?t.set(e):n.add(e)}),n.forEach(function(e){var s=t(e.name);s||(i=!0,n.remove(e))}),i&&this.trigger("change:layers",n),this.resize()},d.addLayer=function(e){var t=this.model.layers;t.add(e)},d.removeLayer=function(e){var t=this.model.layers;t.remove(t.get(e))},d.updateLayer=function(e,t){this.model.layers.get(t).set(e)},d.heartbeat=function(e,t){this.model.frametime=e,this.model.audio=t},Object.keys(d).forEach(s);var l={};l.initializeClient=function(){var e,t=new window.BroadcastChannel("spike"),i=this;t.addEventListener("message",function(t){var n=t.data.command,s=d[n];"function"==typeof s&&o[n]&&(e=o[n].map(function(e){return"timeStamp"===e?t.timeStamp:t.data.payload[e]}),s.apply(i,e))},!1),t.postMessage({command:"register",payload:{id:"screen"+performance.now()}}),this.channel=t};var h=a.extend(l,{autoRender:!0,template:'<div class="screen"></div>',session:{width:["number",!0,400],height:["number",!0,300],captureMouse:["boolean",!0,!1],captureDebug:["boolean",!0,!1]},initialize:function(){if(!this.model)throw new Error("Missing model option for ScreenView");this.initializeClient()},remove:function(){return this.channel&&this.channel.close(),a.prototype.remove.apply(this,arguments)},resize:function(){return this.el?(this.el.style.position="fixed",this.el.top=0,this.el.left=0,this.el.style.width="100%",this.el.style.height="100%",this.width=this.el.parentNode.clientWidth,this.height=this.el.parentNode.clientHeight,this._resizeLayers()):this},_resizeLayers:function(){if(!this.layersView||!this.layersView.views)return this;var e=this.width,t=this.height;return this.layersView.views.forEach(function(i){i.width=e,i.height=t}),this},render:function(){return this.el||this.renderWithTemplate(),this.layersView||(this.layersView=this.renderCollection(this.model.layers,function(e){var t=e.model.getType(),i=r[t]||r;return new i(e)},this.el,{parent:this}),this._updateLayers()),this._ar||this._animate(),this.resize()},update:function(e){function t(e){return function(t){return t.name===e}}if(!this.layersView)return this.render().update(e);this.model.set(e);var i,n=this.model.layers;return e.layers&&(e.layers.forEach(function(e){i=!0;var t=n.get(e.name);t?t.set(e,{silent:!0}):n.add(e,{silent:!0})}),n.forEach(function(s){var a=e.layers.find(t(s.name));a||(i=!0,n.remove(s,{silent:!0}))}),i&&this.trigger("change:layers",n)),this},_ar:null,_animate:function(e){this.model.frametime=e||0,this._updateLayers(),this._ar=window.requestAnimationFrame(this._animate.bind(this))},_updateLayers:function(){this.layersView.views.forEach(function(e){e.update()})}});e.exports=h},36:function(e,t,i){"use strict";var n=i(13);e.exports=n.canvas=n.extend({template:function(){return'<canvas layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></canvas>'},derived:{offCanvas:{deps:["width","height","el"],fn:function(){var e=document.createElement("canvas");return e.width=this.width,e.height=this.height,e}},ctx:{deps:["offCanvas"],fn:function(){return this.offCanvas.getContext("2d")}},destCtx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}}},remove:function(){return n.prototype.remove.apply(this,arguments)},update:function(){this.model.frametime=this.parent.model.frametime;var e=this.width=this.parent.el.clientWidth,t=this.height=this.parent.el.clientHeight,i=this.ctx;return i.clearRect(0,0,e,t),this.model.active?(this.model.canvasLayers.filter(function(e){return e.active}).forEach(function(e){i.globalAlpha=e.opacity/100,i.globalCompositeOperation=e.blending,e.draw(i)}),this.destCtx.clearRect(0,0,e,t),this.destCtx.drawImage(this.offCanvas,0,0,e,t,0,0,e,t),this):this},bindings:VFDeps.assign({width:{name:"width",type:"attribute"},height:{name:"height",type:"attribute"}},n.prototype.bindings)})},37:function(e,t,i){"use strict";var n=i(13);e.exports=n.img=n.extend({template:function(){return'<div class="layer-image" layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></div>'},bindings:VFDeps.assign({"model.src":{type:function(){this.el.style.backgroundImage="url("+this.model.src+")"}},"model.backgroundSize":{type:function(){this.el.style.backgroundSize=this.model.backgroundSize}},"model.backgroundPosition":{type:function(){this.el.style.backgroundPosition=this.model.backgroundPosition}},"model.backgroundRepeat":{type:function(){this.el.style.backgroundRepeat=this.model.backgroundRepeat}}},n.prototype.bindings)})},38:function(e,t,i){"use strict";var n=0,s=i(13);e.exports=s.SVG=s.extend({autoRender:!0,template:function(){return'<div class="layer-svg" layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></div>'},extractStyles:function(){var e=this;return this.queryAll("[style]").forEach(function(t){t.id||(n++,t.id="auto-svg-id-"+n),e.addRule("#"+t.id,t.getAttribute("style")),t.removeAttribute("style")}),this},editStyles:function(){},loadSVG:function(){var e=this,t=e.model.src,i=e.el;t&&i&&fetch(t).then(function(e){return e.text()}).then(function(t){i.innerHTML=t,e.extractStyles()})},initialize:function(){s.prototype.initialize.apply(this,arguments),this.on("change:rendered",this.loadSVG),this.listenToAndRun(this.model,"change:src",this.loadSVG)},remove:function(){var e=this.styleEl;e.parentNode.removeChild(e),s.prototype.remove.apply(this,arguments)},render:function(){return this.el?this:(this.renderWithTemplate(),this)}})},39:function(e,t,i){"use strict";var n=i(13);e.exports=n.video=n.extend({template:function(){return'<video layer-id="'+this.model.cid+'" view-id="'+this.cid+'" autoplay loop muted></video>'},bindings:VFDeps.assign({"model.src":{type:"attribute",name:"src"}},n.prototype.bindings)})}});
//# sourceMappingURL=3-build.js.map