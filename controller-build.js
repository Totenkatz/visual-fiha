!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a){if(a=a||{},!a.reboot&&a.record){var b=window.localStorage.getItem("zwv");b=b?JSON.parse(b):!1,a.screenLayers=b?b.screenLayers:a.screenLayers,a.screenSignals=b?b.screenSignals:a.screenSignals,console.info("import stored settings?",b)}if(a.audioSource="https://archive.org/download/compilation_017/yttaaq_-_break_it.mp3",e||(e=new f(a)),a.record){var c,d=VFDeps.throttle(function(){if("frametime"!==arguments[0]){console.time("write json");var a=JSON.stringify(e.toJSON());a!==c&&window.localStorage.setItem("zwv",a),c=a,console.timeEnd("write json")}},62.5);e.screenView.off("all",d),e.screenView.on("all",d)}return e}var e,f=a("./controller/view"),g=window.VF||{},h=g._defaultSetup;h.el=document.querySelector(".controller"),window.visualFiha=d(h)},{"./controller/view":7}],2:[function(require,module,exports){"use strict";var View=window.VFDeps.View,AceEditor=View.extend({edit:function(a,b){a&&b&&this.set({model:a,targetProperty:b}),this.script=this.original,this.editor.setValue(this.original)},template:'<div class="row debug rows"><div class="ace-editor row grow-xl"></div><div class="ace-controls row no-grow gutter columns"><div class="column"></div><div class="column no-grow gutter-right"><button class="no" name="cancel">Cancel</button></div><div class="column gutter-left text-right"><button class="yes" name="apply">Apply</button></div></div></div>',session:{editor:"any",script:["string",!0,""],targetProperty:"string"},derived:{original:{deps:["model","targetProperty"],fn:function(){return(this.model?this.model[this.targetProperty]||"":"").toString()}},changed:{deps:["original","script"],fn:function(){return this.original!=this.script}}},bindings:{changed:{type:"toggle",selector:"button"}},events:{"click [name=cancel]":"_handleCancel","click [name=apply]":"_handleApply"},_handleCancel:function(a){a.preventDefault(),this.model&&this.targetProperty&&this.editor&&this.editor.setValue(this.original)},_handleApply:function(evt){if(evt.preventDefault(),this.model&&this.targetProperty&&this.editor){try{eval("var fn = "+this.script+";")}catch(err){return void console.info("script error!",err.stack,err.message,err.line)}var m=this.model,p=this.targetProperty,s=this.script;m[p]=s,this._cache.changed=!1,this.trigger("original:changed"),this.trigger("change:changed")}},render:function(){if(this.editor)return this;var a=this;a.renderWithTemplate();var b=a.editor=window.ace.edit(a.query(".ace-editor"));return b.$blockScrolling=1/0,b.on("change",function(){a.set("script",b.getValue())}),b.setTheme("ace/theme/monokai"),b.getSession().setMode("ace/mode/javascript"),b.setShowInvisibles(),b.getSession().setUseSoftTabs(!0),b.getSession().setTabSize(2),b.getSession().setUseWrapMode(!0),a.original&&b.setValue(a.original),this}});module.exports=AceEditor},{}],3:[function(a,b,c){"use strict";b.exports=VFDeps.View.extend({autoRender:!0,template:'<canvas width="200" height="200"></canvas>',session:{audioAnalyser:["any",!0,null],lineWidth:["number",!0,1],width:["number",!0,200],height:["number",!0,200],padding:["number",!0,2],color:["string",!0,"#000"]},bindings:{width:{type:"attribute",name:"width"},height:{type:"attribute",name:"height"}},derived:{ctx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}},audioAnalyserDataArray:{deps:["audioAnalyser"],fn:function(){return new window.Uint8Array(this.audioAnalyser.frequencyBinCount)}}},drawScales:function(){var a,b,c,d,e,f,g,h,i,j,k=this.ctx,l=.5*k.canvas.width,m=.5*k.canvas.height,n=Math.min(l,m)-20,o=2*Math.PI;for(k.globalAlpha=.5,a=0;360>a;a+=15)b=o/360*a-Math.PI,i=Math.cos(b),j=Math.sin(b),c=Math.round(l+i*(n/10)),d=Math.round(m+j*(n/10)),e=Math.round(l+i*(n-5)),f=Math.round(m+j*(n-5)),g=Math.round(l+i*n),h=Math.round(m+j*n),k.beginPath(),k.moveTo(c,d),k.lineTo(e,f),k.textAlign="center",l>g?k.textAlign="right":g>l&&(k.textAlign="left"),k.textBaseline="middle",m>h?k.textBaseline="bottom":h>m&&(k.textBaseline="top"),k.globalAlpha=1,k.fillText(a,g,h),k.globalAlpha=.5,k.stroke(),k.closePath();return k.globalAlpha=1,this},update:function(){if(!this.el)return this;var a=this.ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle=a.strokeStyle=this.color;var b=this.audioAnalyser,c=b.frequencyBinCount;this.drawScales(c),a.fillStyle=a.strokeStyle=this.color;var d=this.audioAnalyserDataArray;b.getByteFrequencyData(d);var e,f,g,h,i=.5*a.canvas.width,j=.5*a.canvas.height,k=Math.min(i,j)-20,l=2*Math.PI;for(a.beginPath(),e=0;c>e;e++)f=l/c*e-Math.PI,g=Math.round(i+Math.cos(f)*(k/100*(d[e]/2))),h=Math.round(j+Math.sin(f)*(k/100*(d[e]/2))),a.lineTo(g,h);return a.stroke(),this}})},{}],4:[function(a,b,c){"use strict";var d=a("./../mappable/control-view"),e=VFDeps.View.extend({template:['<section class="row rows">','<header class="row">','<h3>Details for <span data-hook="name"></span></h3>',"</header>",'<div class="row mappings props"></div>',"</section>"].join("\n"),subviews:{mappingsView:{selector:".mappings",prepareView:function(a){return this.renderCollection(this.model.mappings,function(a){var b=a.model.definition.type,c=a.model.targetProperty,e=d[c]||d[b]||d;return new e(a)},a)}}},bindings:{"model.name":"[data-hook=name]"}});b.exports=e},{"./../mappable/control-view":20}],5:[function(a,b,c){"use strict";b.exports=VFDeps.View.extend({autoRender:!0,template:'<canvas width="120" height="29"></canvas>',session:{data:["array",!0,function(){return[]}],lineWidth:["number",!0,1],width:["number",!0,120],height:["number",!0,29],padding:["number",!0,2],color:["string",!0,"#000"],font:["string",!0,"11px sans"]},bindings:{width:{type:"attribute",name:"width"},height:{type:"attribute",name:"height"}},derived:{ctx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}},innerW:{deps:["el","width"],fn:function(){return this.el.width-2*this.lineWidth}},innerH:{deps:["el","height"],fn:function(){return this.el.height-2*this.lineWidth}}},max:function(){var a=0;return this.data.length?(this.data.forEach(function(b){a=Math.max(b,a)}),a):a},min:function(){var a=this.max();return this.data.length?(this.data.forEach(function(b){a=Math.min(b,a)}),a):a},avg:function(){var a=0;return this.data.length?(this.data.forEach(function(b){a+=b}),a/this.data.length):a},update:function(a){function b(a){return i/f*a+g}if(!this.el)return this;var c=this.lineWidth,d=this.ctx,e=this.avg(),f=this.max(),g=2*c,h=this.innerW,i=this.innerH,j=Math.round(h/2);"undefined"!=typeof a&&(this.data.unshift(a),this.data.length>j&&(this.data=this.data.slice(0,-1)));var k=h/(this.data.length-1);d.clearRect(0,0,this.width,this.height),d.font=this.font,d.lineWidth=c,d.lineCap="round",d.lineJoin="round",d.strokeStyle=this.color,d.moveTo(h+g,b(this.data[0])),d.beginPath(),this.data.forEach(function(a,c){var e=h-k*c+g,f=b(a);d.lineTo(e,f)});var l=this.data[0]||0;return d.stroke(),d.beginPath(),d.fillStyle=this.color,d.arc(h+g,b(l),2*c,0,2*Math.PI),d.fill(),d.beginPath(),d.moveTo(g,b(e)),d.lineTo(g+h,b(e)),d.stroke(),l=Math.round(100*e)/100,d.textBaseline="middle",d.textAlign="left",d.clearRect(0,g,d.measureText(l).width+2*g,d.canvas.height-g),d.fillText(l,g,.5*d.canvas.height),this}})},{}],6:[function(a,b,c){"use strict";var d=VFDeps.View.extend({template:"<li></li>",bindings:{"model.text":{type:"text"}},events:{click:"_handleClick"},_handleClick:function(a){a.preventDefault(),this.parent.trigger("selected",this.model.value||this.model.text)}}),e=VFDeps.View.extend({autoRender:!0,attach:function(a,b,c){return this.inputEl="string"==typeof a?this.parent.query(a):a,b=b||function(a){this.inputEl.value=a,this.detach()}.bind(this),this.off("selected"),this.once("selected",b),c&&(c.isCollection?this.collection=c:this.collection.reset(c)),this},fill:function(a){return this.collection.reset(a.map(function(a){return{text:a}})),this.filterCollection()},detach:function(){return this.off("selected"),this.unset("inputEl"),this.collection.reset([]),this},filterCollection:function(){var a=[];if(this.inputEl){var b=this.inputEl.value||this.inputEl.value;a=b?this.collection.filter(function(a){return 0===a.text.indexOf(b)}):this.collection.serialize()}else a=this.collection.serialize();return this.suggestions.reset(a),this},session:{inputEl:"element"},_handleInput:function(){this.filterCollection()},resetPosition:function(){var a=this;return a.el&&a.el.parentNode&&a.inputEl?(a.el.style.visibility="hidden",setTimeout(function(){if(a.el&&a.el.parentNode&&a.inputEl){var b=a.inputEl.getBoundingClientRect(),c=a.el.getBoundingClientRect();b.top>.5*a.el.parentNode.clientHeight?(a.el.style.maxHeight=Math.min(b.top,.33*a.el.parentNode.clientHeight)+"px",a.el.style.top=b.top-a.el.clientHeight-3+"px"):(a.el.style.maxHeight=Math.min(b.bottom,.33*a.el.parentNode.clientHeight)+"px",a.el.style.top=b.bottom+3+"px");var d=window.getComputedStyle(a.inputEl);a.el.style.textAlign=d.textAlign,"right"===d.textAlign?a.el.style.left=b.left-(c.width-b.width)+"px":a.el.style.left=b.left+"px",a.el.style.visibility="visible"}}),a):a},initialize:function(){if(!this.parent)throw new Error("Suggestion view need a parent view");this.collection=this.collection||new VFDeps.Collection([],{parent:this}),this.on("change:collection",function(){this.listenToAndRun(this.collection,"add remove reset",this.filterCollection)}),this.listenTo(this.suggestions,"add remove reset",this.resetPosition);var a=this._handleInput.bind(this);this.on("change:inputEl",function(){var b=this.previousAttributes();b.inputEl&&b.inputEl.removeEventListener("keyup",a);var c=this.el,d=this.parent.el,e=this.inputEl;if(!e)return void(this.el&&this.el.parentNode===d&&d.removeChild(this.el));if(c&&d){if(c.parentNode!==d){var f=window.getComputedStyle(d);"static"===f.position&&(d.style.position="relative"),d.appendChild(c)}this.resetPosition(),e.addEventListener("keyup",a)}});var b=function(a){a.preventDefault(),a.target===this.inputEl||this.el.contains(a.target)||this.detach()}.bind(this);this.listenToAndRun(this.parent,"change:el",function(){var a=this.parent.previousAttributes();a.el&&a.el.removeEventListener("click",b),this.parent.el&&this.parent.el.addEventListener("click",b)})},collections:{suggestions:VFDeps.Collection.extend({model:VFDeps.State.extend({props:{text:["string",!0,""],value:["any",!1,null]}})})},template:'<ul class="suggestion-view"></ul>',render:function(){return this.renderWithTemplate(),this.items=this.renderCollection(this.suggestions,d,this.el),this}});b.exports=e},{}],7:[function(a,b,c){"use strict";var d=VFDeps.View,e=VFDeps.debounce,f=VFDeps.ResizeSensor,g=a("./../screen/view"),h=a("./../screen/state"),i=a("./../midi/state"),j=a("./../midi/view"),k=a("./../layer/control-view");a("./../layer/canvas/control-view");var l=a("./../signal/control-view");a("./../signal/beat/control-view"),a("./../signal/hsla/control-view"),a("./../signal/rgba/control-view");var m=a("./suggestion-view"),n=a("./sparkline-view"),o=a("./audio-monitor-view"),p=a("./ace-view"),q=a("./../mappable/multi-control-view"),r=d.extend({initialize:function(a){var b=this;b.model=b.model||new h({screenLayers:a.screenLayers,screenSignals:a.screenSignals}),b.model.signals={},window.BroadcastChannel&&(b.channel=new window.BroadcastChannel(this.broadcastId)),b.on("change:audioContext change:audioAnalyser",this.connectAudioSource),this.connectAudioSource(),b.el?b._attachSuggestionHelper():b.once("change:el",b._attachSuggestionHelper),b.model.signals.midi={},b.listenToAndRun(b.midiAccess,"midi",function(a,c){b.model.signals.midi[a]=c,b.model.trigger(a,c)}),a.autoStart!==!1&&b.play()},connectAudioSource:function(){function a(a){var b=c.audioContext.createMediaStreamSource(a);b.connect(c.audioAnalyser)}function b(a){console.info("The following gUM error occured: "+a)}var c=this,d={audio:!0};return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(d).then(a)["catch"](b):navigator.getUserMedia&&navigator.getUserMedia(d,a,b),this},_animate:function(a){this.controllerSparkline&&this.controllerSparkline.update(a-this.model.frametime-this.model.firstframetime),this.latencySparkline&&this.latencySparkline.update(this.screenView.model.latency),this.model.frametime=a-this.model.firstframetime,this.update(),this._arId=window.requestAnimationFrame(this._animate.bind(this))},update:function(){var a=this.audioAnalyser,b=a.frequencyBinCount,c=this.audioAnalyserDataArray;a.getByteFrequencyData(c),this.model.signals.mic={};for(var d=0;b>d;d++)this.model.trigger("mic:"+d,c[d]);var e=this.model.serialize();this.channel.postMessage({type:"update",data:e})},derived:{playing:{deps:["_arId"],fn:function(){return!!this._arId}},computedStyle:{deps:["el"],fn:function(){return window.getComputedStyle(this.el)}},signalNames:{deps:["screenView"],fn:function(){for(var a=[],b=this.audioAnalyser,c=b.frequencyBinCount,d=0;c>d;d++)a.push("mic:"+d);return a.concat(this.screenView?this.screenView.signalNames:[],this.midiAccess.signalNames)}},audioContext:{deps:[],fn:function(){return new window.AudioContext}},audioAnalyser:{deps:["audioContext","model","model.audioMinDb","model.audioMaxDb","model.audioSmoothing","model.audioFftSize"],fn:function(){var a=this.audioContext.createAnalyser();return a.minDecibels=this.model.audioMinDb,a.maxDecibels=this.model.audioMaxDb,a.smoothingTimeConstant=this.model.audioSmoothing,a.fftSize=this.model.audioFftSize,a}},audioAnalyserDataArray:{deps:["audioAnalyser"],fn:function(){return new window.Uint8Array(this.audioAnalyser.frequencyBinCount)}}},children:{midiAccess:i},session:{broadcastId:["string",!0,"vfBus"],_arId:"number",currentDetails:"state"},play:function(){if(console.info("play",this._arId,this.model.firstframetime),this._arId)throw new Error("Animation already played");return this.model.firstframetime=this.model.firstframetime||performance.now(),this._animate(this.model.firstframetime)},pause:function(){return console.info("pause",this._arId,this.model.firstframetime),this._arId&&window.cancelAnimationFrame(this._arId),this._arId=null,this},stop:function(){return console.info("stop",this._arId,this.model.firstframetime),this.pause(),this.model.firstframetime=0,this},resizeScreen:function(){this.channel.postMessage({type:"resize"})},subviews:{MIDIAccess:{waitFor:"el",selector:".midi-access",prepareView:function(a){var b=new j({parent:this,el:a,model:this.midiAccess});return b}},codeEditor:{waitFor:"el",selector:".debug",prepareView:function(a){return new p({el:a,parent:this})}},audioMonitor:{waitFor:"el",selector:".audio-monitor",prepareView:function(a){var b=window.getComputedStyle(a),c=new o({audioAnalyser:this.audioAnalyser,parent:this,color:b.color});return a.appendChild(c.el),this.listenToAndRun(this.model,"change:frametime",function(){c.update()}),c}},controllerSparkline:{waitFor:"el",selector:".sparkline-controller",prepareView:function(a){var b=window.getComputedStyle(a),c=new n({parent:this,color:b.color,font:b.fontSize+" "+b.fontFamily.split(" ").pop()});return a.appendChild(c.el),c}},latencySparkline:{waitFor:"el",selector:".sparkline-latency",prepareView:function(a){var b=window.getComputedStyle(a),c=new n({parent:this,color:b.color,font:b.fontSize+" "+b.fontFamily.split(" ").pop()});return a.appendChild(c.el),c}},screenView:{waitFor:"el",selector:".screen",prepareView:function(a){this.screenView&&this.screenView.remove();var b=new h(this.model.toJSON()),c=new g({parent:this,el:a,model:b,mode:"control"}),d=this.query(".screen-cell").parentNode;return this.screenCellSensor=new f(d,e(function(){c.resize(d)},50)),c}},screenLayersView:{waitFor:"el",selector:".layers .items",prepareView:function(a){return this.renderCollection(this.model.screenLayers,function(a){var b=a.model.getType(),c=k[b]||k;return new c(a)},a)}},screenSignalsView:{waitFor:"el",selector:".signals .items",prepareView:function(a){return this.renderCollection(this.model.screenSignals,function(a){var b=a.model.getType(),c=l[b]||l;return new c(a)},a)}},multiMappings:{waitFor:"el",selector:".multi-mapping",prepareView:function(a){var b=new q({parent:this,el:a});return b.listenTo(b.mappings,"all",function(a){console.info("mutli mapping collection evt",a)}),b}}},_attachSuggestionHelper:function(){this.suggestionHelper||(this.suggestionHelper=this.registerSubview(new m({parent:this})))},remove:function(){this.perfInterval&&clearInterval(this.perfInterval),this.screenCellSensor&&this.screenCellSensor.detach&&this.screenCellSensor.detach(),d.prototype.remove.apply(this,arguments)},toJSON:function(){return this.screenView.toJSON()},bindings:{_arId:[{type:"toggle",selector:'[name="play"]',invert:!0},{type:"toggle",selector:'[name="pause"]'}],"model.audioMinDb":{selector:'[name="audioMinDb"]',type:"value"},"model.audioMaxDb":{selector:'[name="audioMaxDb"]',type:"value"},"model.audioSmoothing":{selector:'[name="audioSmoothing"]',type:"value"},"model.audioFftSize":{selector:'[name="audioFftSize"]',type:"value"}},events:{'click [name="play"]':"play",'click [name="pause"]':"pause",'click [name="stop"]':"stop",'click [name="resize"]':"resizeScreen",'click [name="debug"]':"_debug",'click [name="screen"]':"_openScreen",'click [name="ratio"]':"_changeRatio",'click [name="add-layer"]':"_addLayer",'click [name="add-signal"]':"_addSignal",'focus [data-hook="layer-type"]':"_suggestLayerType",'focus [data-hook="signal-type"]':"_suggestSignalType","change .audio-source [name]":"_changeAudioParams"},_debug:function(){this.screenView.captureDebug=!0},_openScreen:function(){window.open("./screen.html#"+this.broadcastId,"screen","width=800,height=600,location=no")},_changeRatio:function(a){var b=a.target.value;this.screenView.ratio="0"===b?0:"4/3"===b?4/3:16/9,this.screenView.resize()},_suggestLayerType:function(){var a=this.suggestionHelper,b=this.queryByHook("layer-type");a.attach(b,function(c){b.value=c,a.detach()}).fill(["default","img","SVG","canvas"])},_suggestSignalType:function(){var a=this.suggestionHelper,b=this.queryByHook("signal-type");a.attach(this.queryByHook("signal-type"),function(c){b.value=c,a.detach()}).fill(["default","beatSignal","hslaSignal","rgbaSignal"])},_changeAudioParams:function(a){this.model.set(a.target.name,Number(a.target.value)),this.audioMonitor.set("audioAnalyser",this.audioAnalyser)},addMultiMapping:function(a){console.info("add multi mapping",a.targetProperty,a.targetModel),this.multiMappings.mappings.add({targetModel:a.targetModel,targetProperty:a.targetProperty})},showDetails:function(a){return a===this.currentDetails?this:(this.detailsSwitcher.set(a),this)},_addSignal:function(){var a=this.queryByHook("signal-type"),b=this.queryByHook("signal-name"),c=a.value,d=b.value;c&&d&&(this.model.screenSignals.add({name:d,type:c}),a.value=b.value="")},_addLayer:function(){var a=this.queryByHook("signal-type"),b=this.queryByHook("signal-name"),c=a.value,d=b.value;c&&d&&(this.model.screenLayers.add({name:d,type:c}),a.value=b.value="")},render:function(){var a=this;return this.renderWithTemplate(),this.cacheElements({jsHeapLimit:".heap-limit span",jsHeapTotal:".heap-total span",jsHeapUsed:".heap-used span",detailsEl:".details"}),this.detailsSwitcher=new VFDeps.ViewSwitcher(this.detailsEl,{show:function(b){a.currentDetails=b}}),this.perfInterval&&clearInterval(this.perfInterval),this},autoRender:!0,template:'<div class="controller rows"><div class="row columns gutter-horizontal header"><div class="column no-grow gutter-right">Visual Fiha</div><div class="column columns"><div class="column columns gutter-horizontal no-grow"><span class="column columns button-group"><button class="column gutter-right" name="play"><span class="vfi-play"></span></button><button class="column gutter-horizontal" name="pause"><span class="vfi-pause"></span></button><button class="column gutter-horizontal" name="stop"><span class="vfi-stop"></span></button><button class="column gutter-left" name="resize"><span class="vfi-circle"></span></button></span></div><div class="column columns gutter-horizontal no-grow"><span class="column">Screen ratio</span><span class="column columns gutter-horizontal button-group"><button class="column gutter-horizontal" name="ratio" value="16/9">16/9</button><button class="column gutter-horizontal" name="ratio" value="4/3">4/3</button><button class="column gutter-horizontal" name="ratio" value="0">free</button></span><div class="column gutter-left"><button name="screen">Open screen</button></div></div><div class="column gutter-horizontal no-grow columns performance">SCL <span title="Screen Communication Latency" class="column sparkline-latency"></span>Controller <span class="column sparkline-controller"></span></div></div><div class="column gutter-horizontal"><button name="debug">Debug</button></div></div><div class="row columns body"><div class="column no-grow rows"><div class="row grow-l screen-cell"><div class="screen"></div></div><div class="row no-grow details"></div><div class="row debug"></div></div><div class="column rows settings"><div class="row columns"><div class="column rows"><div class="row layers"><div class="section-name gutter">Layers</div><div class="columns gutter"><div class="column gutter-right"><input data-hook="layer-name" placeholder="Name" type="text"/></div><div class="column gutter-horizontal"><input data-hook="layer-type" placeholder="Type" type="text"/></div><div class="column no-grow gutter-left"><button name="add-layer" class="vfi-plus"></button></div></div><div class="items"></div></div></div><div class="column rows"><div class="row signals"><div class="section-name gutter">Signals</div><div class="columns gutter"><div class="column gutter-right"><input data-hook="signal-name" placeholder="Name" type="text"/></div><div class="column gutter-horizontal"><input data-hook="signal-type" placeholder="Type" type="text"/></div><div class="column no-grow gutter-left"><button name="add-signal" class="vfi-plus"></button></div></div><div class="items"></div></div></div></div><div class="row no-grow columns"><div class="multi-mapping"></div></div><div class="row no-grow columns"><div class="column midi-access"></div><div class="column rows audio-source"><div class="row columns"><div class="column audio-monitor"></div><div class="column audio-controls"><label>MinDb: <input type="number" name="audioMinDb" value="-90" step="1" /></label><label>MaxDb: <input type="number" name="audioMaxDb" value="-10" min="-70" step="1" /></label><label>Smoothing: <input type="number" name="audioSmoothing" value="0.85" step="0.01" /></label><label>FftSize: <select type="number" name="audioFftSize" value="32" step="2"><option value="32">32</option><option value="64">64</option><option value="128">128</option><option value="256">256</option><option value="1024">1024</option><option value="2048">2048</option></select></label></div></div></div></div></div></div></div>'});b.exports=r},{"./../layer/canvas/control-view":8,"./../layer/control-view":11,"./../mappable/multi-control-view":21,"./../midi/state":23,"./../midi/view":24,"./../screen/state":25,"./../screen/view":26,"./../signal/beat/control-view":27,"./../signal/control-view":29,"./../signal/hsla/control-view":31,"./../signal/rgba/control-view":33,"./ace-view":2,"./audio-monitor-view":3,"./sparkline-view":5,"./suggestion-view":6}],8:[function(a,b,c){"use strict";var d=a("./../control-view"),e=VFDeps.View.extend({template:'<section class="canvas-layer"><header class="columns"><div class="column no-grow gutter-right"><button name="active"></button></div><div class="column no-grow gutter-horizontal"><button class="edit-draw-function vfi-cog-alt"></button></div><h3 class="column canvas-layer-name gutter-horizontal" data-hook="name"></h3><div class="column no-grow text-right gutter-left"><button class="vfi-trash-empty remove-canvas-layer"></button></div></header></section>',derived:{rootView:{deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}},codeEditor:{deps:["rootView"],fn:function(){return this.rootView.codeEditor}}},events:{"click .remove-canvas-layer":"_removeLayer","click .edit-draw-function":"_editDrawFunction",'click [name="active"]':"_toggleActive","click .canvas-layer-name":"_showMappings"},_showMappings:d.prototype._showMappings,_toggleActive:d.prototype._toggleActive,_editDrawFunction:function(){var a=this.codeEditor;a.changed?console.warn("A function is already being edited"):a.edit(this.model,"drawFunction")},bindings:{"model.active":[{type:"booleanClass",name:"disabled",invert:!0},{type:"booleanClass",selector:'[name="active"]',yes:"vfi-toggle-on",no:"vfi-toggle-off"}],drawFunction:"[data-hook=drawFunction]","model.name":"[data-hook=name]","model.duration":"[data-hook=duration]","model.fps":"[data-hook=fps]","model.frametime":"[data-hook=frametime]"}});b.exports=d.canvas=d.extend({template:'<section class="row canvas-control"><header class="rows"><div class="row columns"><div class="column no-grow"><button class="active prop-toggle"></button></div><h3 class="column layer-name" data-hook="name"></h3></div><div class="row columns"><input type="text" class="column gutter-right" placeholder="new-layer-name" data-hook="new-layer-name" /><input type="text" class="column gutter-horizontal" placeholder="propA, propB" data-hook="new-layer-props" /><div class="column no-grow gutter-left"><button name="add-layer" class="vfi-plus"></button></div></div></header><div class="layers"><div class="items"></div></div></section>',events:VFDeps.assign({"change [data-hook=new-layer-name]":"_inputLayerName","click [name=add-layer]":"_addLayer"},d.prototype.events),_inputLayerName:function(){this.query("[name=add-layer]").disabled=!this.queryByHook("new-layer-name").value.trim()},_addLayer:function(a){a.preventDefault();var b=this.queryByHook("new-layer-name"),c=b.value.trim(),d=this.queryByHook("new-layer-props"),e=d?d.value.split(",").map(function(a){return a.trim()}).filter(function(a){return a}):[],f={};e.forEach(function(a){f[a]="any"});var g=this.model.canvasLayers.add({name:c,drawFunction:"function(ctx) {\n  // "+c+" drawFunction\n}",props:f});if(!g)return void console.warn("new layer?",g);b.value="";var h=this.model.canvasLayersView.views.find(function(a){return a.model===g});h.codeEditor.changed||h.codeEditor.edit(g,"drawFunction")},initialize:function(){this.once("change:rendered",this._inputLayerName)},subviews:{canvasLayersView:{waitFor:"el",selector:".layers .items",prepareView:function(a){return this.renderCollection(this.model.canvasLayers,e,a)}}}})},{"./../control-view":11}],9:[function(require,module,exports){"use strict";var ScreenLayerState=require("./../state"),MappableState=require("./../../mappable/state"),CanvasLayerMapState=MappableState.State.extend({derived:{targetModel:{deps:["collection","collection.parent"],fn:function(){return this.collection.parent}},observedModel:{deps:["targetModel","targetModel.collection","targetModel.collection.parent"],fn:function(){return this.targetModel.collection.parent.collection.parent}}}}),CanvasLayer=MappableState.extend({idAttribute:"name",fillCollection:function(){var a=this.mappings,b=Object.keys(this.constructor.prototype._definition).filter(function(a){return["drawFunction","name"].indexOf(a)<0});return b.forEach(function(b){a.get(b)||a.add({targetProperty:b})}),this},session:{duration:["number",!0,1e3]},cache:{},props:{fps:["number",!0,16],weight:["number",!0,0],name:["string",!0,null],active:["boolean",!0,!0],opacity:["number",!0,100],shadowOffsetX:["number",!0,0],shadowOffsetY:["number",!0,0],shadowBlur:["number",!0,0],shadowColor:["string",!0,"rgba(0,0,0,0.5)"],blending:{type:"string",required:!0,"default":"source-over",values:["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","copy","xor"]},drawFunction:"any"},serialize:function(){var a=MappableState.prototype.serialize.apply(this,arguments),b={},c=this.serializationProps.props||[];c.length&&(b.props={});var d,e=this.constructor.prototype._definition;for(d in a)b[d]=a[d],c.indexOf(d)>-1&&(b.props[d]=e[d]);b.props=e;var f=typeof this.drawFunction;return"function"===f?b.drawFunction=this.drawFunction.toString():"string"===f&&(b.drawFunction=this.drawFunction),b},derived:{frames:{deps:["duration","fps"],fn:function(){return Math.round(this.duration/1e3*this.fps)}},frame:{deps:["frametime","fps"],fn:function(){return Math.round(this.frametime%this.duration/1e3*this.fps)}},direction:{deps:["frametime","duration"],fn:function(){return this.frame<.5*this.frames?1:-1}},frametime:{cache:!1,fn:function(){return this.screenState.frametime}},screenState:{deps:["collection","collection.parent","collection.parent.collection","collection.parent.collection.parent"],fn:function(){return this.collection.parent.collection.parent}},width:{deps:["screenState","screenState.width"],fn:function(){return this.screenState.width||400}},height:{deps:["screenState","screenState.height"],fn:function(){return this.screenState.height||300}},draw:{deps:["drawFunction"],fn:function(){var fn=this.drawFunction;if("string"==typeof fn)try{eval("fn = (function() { return "+this.drawFunction+"; })()")}catch(err){console.warn("draw function error",err)}return("function"==typeof fn?fn:function(){}).bind(this)}}},collections:{mappings:MappableState.Collection.extend({model:function(a,b){var c=new CanvasLayerMapState(a,b);return b.init===!1&&c.initialize(),c}})}}),_CanvasLayersCache={},CanvasLayers=VFDeps.Collection.extend({mainIndex:CanvasLayer.prototype.idAttribute,comparator:"weight",model:function(a,b){var c={props:a.props||{},serializationProps:{props:Object.keys(a.props||{})}},d=_CanvasLayersCache[a.name]||CanvasLayer.extend(c);_CanvasLayersCache[a.name]=d;var e=new d(a,b);return e.on("change:weight",function(){e.collection.sort()}),b.init===!1&&e.initialize(),e}});module.exports=ScreenLayerState.canvas=ScreenLayerState.extend({collections:{canvasLayers:CanvasLayers}})},{"./../../mappable/state":22,"./../state":14}],10:[function(a,b,c){"use strict";var d=a("./../view");b.exports=d.canvas=d.extend({template:function(){return'<canvas layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></canvas>'},derived:{offCanvas:{deps:["width","height","el"],fn:function(){var a=document.createElement("canvas");return a.width=this.width,a.height=this.height,a}},ctx:{deps:["offCanvas"],fn:function(){return this.offCanvas.getContext("2d")}},destCtx:{deps:["el","width","height"],fn:function(){return this.el.getContext("2d")}}},remove:function(){return d.prototype.remove.apply(this,arguments)},update:function(a){a=a||{},this.model.frametime=a.frametime||0;var b=this.width=this.parent.el.clientWidth,c=this.height=this.parent.el.clientHeight,d=this.ctx;return d.clearRect(0,0,b,c),this.model.active?(this.model.canvasLayers.filter(function(a){return a.active}).forEach(function(a){d.shadowOffsetX=a.shadowOffsetX,d.shadowOffsetY=a.shadowOffsetY,d.shadowBlur=a.shadowBlur,d.shadowColor=a.shadowColor,d.globalAlpha=a.opacity/100,d.globalCompositeOperation=a.blending,a.draw(d)}),this.destCtx.clearRect(0,0,b,c),this.destCtx.drawImage(this.offCanvas,0,0,b,c,0,0,b,c),this):this},bindings:VFDeps.assign({},d.prototype.bindings)})},{"./../view":19}],11:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=a("./../controller/details-view"),f=d.extend({template:'<section class="default-layer-control"><header class="columns"><div class="column no-grow gutter-right"><button class="active prop-toggle"></button></div><h3 class="column layer-name gutter-left" data-hook="name"></h3></header><div class="preview gutter-horizontal"></div><div class="mappings props"></div></section>',derived:{rootView:{
deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}}},events:{"click .remove-layer":"_removeLayer","click .active.prop-toggle":"_toggleActive","click .layer-name":"_showMappings"},_removeLayer:function(){this.model.collection.remove(this.model)},_toggleActive:function(){this.model.toggle("active")},_showMappings:function(a){a&&(a.stopPropagation(),a.preventDefault()),this._detailsView=this._detailsView||new e({parent:this,model:this.model}),this.rootView.showDetails(this._detailsView)},bindings:{"model.active":[{type:"booleanClass",name:"disabled",invert:!0},{type:"booleanClass",selector:".active.prop-toggle",yes:"vfi-toggle-on",no:"vfi-toggle-off"}],"model.name":{hook:"name",type:"text"},"model.type":[{hook:"type",type:"text"},{type:"class"}]}});b.exports=f},{"./../controller/details-view":4}],12:[function(a,b,c){"use strict";var d=a("./../state");b.exports=d.img=d.extend({props:{src:["string",!0,null],backgroundSize:["string",!0,"cover"],backgroundRepeat:["string",!0,"no-repeat"]},initialize:function(){if(d.prototype.initialize.apply(this,arguments),!this.src)throw new Error("Missing src attribute for img layer")}})},{"./../state":14}],13:[function(a,b,c){"use strict";var d=a("./../view");b.exports=d.img=d.extend({template:function(){return'<div class="layer-image" layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></div>'},bindings:VFDeps.assign({width:{name:"width",type:"attribute"},height:{name:"height",type:"attribute"},"model.src":{type:function(){this.el.style.backgroundImage="url("+this.model.src+")"}},"model.backgroundSize":{type:function(){this.el.style.backgroundSize=this.model.backgroundSize}},"model.backgroundRepeat":{type:function(){this.el.style.backgroundRepeat=this.model.backgroundRepeat}}},d.prototype.bindings)})},{"./../view":19}],14:[function(a,b,c){"use strict";var d=a("./../mappable/state"),e=d.extend({idAttribute:"name",typeAttribute:"type",props:{active:["boolean",!0,!0],mixBlendMode:{type:"string","default":"normal",required:!0,values:["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color"]},name:["string",!0,null],opacity:{type:"number","default":100},rotateX:{type:"number","default":0},rotateY:{type:"number","default":0},rotateZ:{type:"number","default":0},translateX:{type:"number","default":0},translateY:{type:"number","default":0},scaleX:{type:"number","default":100},scaleY:{type:"number","default":100},skewX:{type:"number",required:!1,"default":0},skewY:{type:"number",required:!1,"default":0},type:["string",!0,"default"],zIndex:["number",!0,0]}});b.exports=e},{"./../mappable/state":22}],15:[function(a,b,c){"use strict";var d=a("./../state");b.exports=d.SVG=d.extend({props:{src:["string",!0,null],styles:["string",!0,""]},initialize:function(){if(d.prototype.initialize.apply(this,arguments),!this.src)throw new Error("Missing src attribute for SVG layer")}})},{"./../state":14}],16:[function(a,b,c){"use strict";var d=0,e=a("./../view");b.exports=e.SVG=e.extend({autoRender:!0,template:function(){return'<div class="layer-svg" layer-id="'+this.model.cid+'" view-id="'+this.cid+'"></div>'},derived:{styleEl:{deps:["model.src"],fn:function(){var a=document.createElement("style");return a.id=this.cid,document.head.appendChild(a),a}}},bindings:VFDeps.assign({},e.prototype.bindings),extractStyles:function(){var a=this.cid,b=this.styleEl;return this.queryAll("[style]").forEach(function(c){var e=c.getAttribute("style");c.id||(d++,c.id="auto-svg-id-"+d),b.innerHTML+="\n/* "+c.id+' */\n [view-id="'+a+'"] #'+c.id+" {\n"+e.split(";").join(";\n  ")+"\n}",c.removeAttribute("style")}),this},editStyles:function(){},loadSVG:function(){var a=this,b=a.model.src,c=a.el;b&&c&&fetch(b).then(function(a){return a.text()}).then(function(d){c.innerHTML=d,console.info("fetched %s",b,d.length),a.extractStyles()})},initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("change:rendered",this.loadSVG),this.listenToAndRun(this.model,"change:src",this.loadSVG)},remove:function(){var a=this.styleEl;console.info("remove svg style element",a),a.parentNode.removeChild(a),e.prototype.remove.apply(this,arguments)},render:function(){return this.el?this:(this.renderWithTemplate(),this)}})},{"./../view":19}],17:[function(a,b,c){"use strict";var d=a("./../state");b.exports=d.video=d.extend({props:{src:["string",!0,null]},initialize:function(){if(d.prototype.initialize.apply(this,arguments),!this.src)throw new Error("Missing src attribute for video layer")}})},{"./../state":14}],18:[function(a,b,c){"use strict";var d=a("./../view");b.exports=d.video=d.extend({template:"<video autoplay loop muted></video>",bindings:VFDeps.assign({"model.src":{type:"attribute",name:"src"}},d.prototype.bindings)})},{"./../view":19}],19:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=d.extend({template:function(){return'<div class="missing-layer-view" style="will-change:transform, opacity, backfaceVisibility;width:100%;height:100%;display:table"><div style="display:table-cell;color:#a66;vertical-align:middle;text-align:center;font-weight:700;font-size:30px;text-shadow:0 0 4px #000">Missing <span data-hook="type"></span> for <span data-hook="name"></span> layer view<br/><span data-hook="frametime"></span> </div></div>'},derived:{style:{deps:["width","height","model.opacity","model.skewX","model.skewY","model.rotateX","model.rotateY","model.rotateZ","model.translateX","model.translateY","model.scaleX","model.scaleY","model.originX","model.originY","model.backfaceVisibility","model.mixBlendMode","model.zIndex"],fn:function(){return{opacity:.01*this.model.opacity,mixBlendMode:this.model.mixBlendMode,width:this.width+"px",height:this.height+"px",zIndex:this.zIndex||0,perspective:this.model.perspective+"px",transform:"rotateX("+this.model.rotateX+"deg) rotateY("+this.model.rotateY+"deg) rotateZ("+this.model.rotateZ+"deg) translateX("+this.model.translateX+"%) translateY("+this.model.translateY+"%) scaleX("+.01*this.model.scaleX+") scaleY("+.01*this.model.scaleY+") skewX("+this.model.skewX+"deg) skewY("+this.model.skewY+"deg) "}}}},session:{width:["number",!0,400],height:["number",!0,300]},bindings:{width:{name:"width",type:"attribute"},height:{name:"height",type:"attribute"},"model.active":{type:"toggle"},"model.type":"[data-hook=type]","model.name":"[data-hook=name]",style:{type:function(){var a=this.style,b=this.el.style;Object.keys(a).forEach(function(c){b[c]=a[c]})}}},update:function(){}});b.exports=e},{}],20:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=window.VFDeps.assign,f=d.extend({initialize:function(){var a=this,b=this.model.targetProperty,c=this.model.targetModel;this.listenToAndRun(c,"change:"+b,function(){a.propValue=c[b]})},derived:{rootView:{deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}},signalNames:{deps:["rootView","rootView.signalNames"],fn:function(){return this.rootView?this.rootView.signalNames||[]:[]}}},events:{"click [name=to-multi-mapping]":"_addToMulti","click [name=default-value]":"_defaultValue","click [name=clear-mapping]":"_clearMapping","focus [data-hook=value]":"_valueFocus","wheel [data-hook=value]":"_valueWheel","paste [data-hook=value]":"_valueChange","change [data-hook=value]":"_valueChange","focus [data-hook=mapping]":"_mappingFocus","blur [data-hook=mapping]":"_mappingBlur","paste [data-hook=mapping]":"_mappingChange","change [data-hook=mapping]":"_mappingChange"},_addToMulti:function(){this.rootView.addMultiMapping(this.model)},_defaultValue:function(a){a.preventDefault();var b=this.model.definition["default"],c="function"==typeof b?b():b;this.model.targetModel.set(this.model.targetProperty,c)},_clearMapping:function(a){a.preventDefault(),this.model.unset("eventNames"),this.model.targetModel.trigger("change:mappings",this.model.targetModel.mappings),a.shiftKey||this._defaultValue(a)},_mappingFocus:function(){var a=this.rootView.suggestionHelper;if(a){var b=this.queryByHook("mapping"),c=this.model,d=c.targetModel;a.attach(b,function(b){c.eventNames=b,d.trigger("change:mappings",d.mappings),a.detach()}).fill(this.signalNames)}},_mappingBlur:function(){this._mappingChange()},_mappingChange:function(){var a=this.model,b=a.targetModel,c=this.queryByHook("mapping"),d=c.value.trim();(a.eventNames||"")!==d&&(a.eventNames=d,b.trigger("change:mappings",b.mappings))},_valueFocus:function(){var a=this.model,b=a.targetModel,c=this.model.definition;if(!c)return void console.warn("no model definition",this.model);var d=this.queryByHook("value");if(d.select&&d.select(),c.values&&c.values.length>1){var e=this.rootView.suggestionHelper;if(!e)return;e.attach(d,function(c){d.value=c,b[a.targetProperty]=c,e.detach()}).fill(c.values)}},_valueWheel:function(a){if(a.target===document.activeElement&&a.shiftKey){a.preventDefault();var b=this.model.definition,c=this.queryByHook("value"),d=c.value.trim(),e=Math.round(a.wheelDeltaX*(1/120));if(b.values&&b.values.length>1){var f=b.values.indexOf(d);0>f&&(f=0),e>0&&f===b.values.length-1?f=0:0>e&&0===f?f=b.values.length-1:f+=e,d=b.values[f]}else"number"===b.type&&(d=Number(d)+e,b.min&&(d=Math.min(b.min,d)),b.max&&(d=Math.max(b.max,d)));c.value=d,this._valueChange()}},_valueChange:function(){var a=this.model,b=a.targetModel,c=a.definition;if(c){var d=this.queryByHook("value").value.trim();switch(c.type){case"number":d=""===d?c["default"]:Number(d);break;case"boolean":d="false"!==d&&d?!0:!1;break;default:d=""===d?c["default"]:d}c.values&&c.values.indexOf(d)<0||b[a.targetProperty]!==d&&(b[a.targetProperty]=d)}},session:{popupEl:"element",popupHolderEl:["element",!1,function(){return document.body}],propValue:"any",propEvent:["string",!0,""]},bindings:{"model.targetProperty":[{selector:".prop-name"},{type:"class"}],"model.eventNames":[{selector:"[data-hook=value]",type:function(a,b){a.disabled=!!b}},{selector:"[data-hook=mapping]",type:"value"}],propValue:{hook:"value",type:"value"}},template:'<div class="prop columns"><span class="column no-grow gutter-right"><button name="to-multi-mapping" class="vfi-attach"></button></span><strong class="prop-name column gutter-horizontal"></strong><span class="column columns"><span class="column no-grow gutter-horizontal"><button name="default-value" class="vfi-trash-empty"></button></span><input type="text" class="column gutter-left" placeholder="Value" data-hook="value" /></span><span class="column columns mapping"><input type="text" class="column gutter-right" placeholder="Events" data-hook="mapping" /><span class="column gutter-left no-grow"><button name="clear-mapping" class="vfi-trash-empty"></button></span></span></div>'});f["boolean"]=f.extend({template:'<div class="prop columns"><span class="column no-grow gutter-right"><button name="to-multi-mapping" class="vfi-attach"></button></span><strong class="prop-name column gutter-horizontal"></strong><span class="column columns"><span class="column no-grow gutter-horizontal"><button name="default-value" class="vfi-trash-empty"></button></span><span class="column gutter-left"><button data-hook="value"></button></span></span><span class="column columns mapping"><input class="column gutter-right" placeholder="Events" data-hook="mapping" /><span class="column gutter-left no-grow"><button name="clear-mapping" class="vfi-trash-empty"></button></span></span></div>',bindings:{propValue:{hook:"value",type:"booleanClass",yes:"vfi-toggle-on",no:"vfi-toggle-off"},"model.targetProperty":[{selector:".prop-name"},{type:"class"}],"model.eventNames":[{selector:"[data-hook=value]",type:function(a,b){a.disabled=!!b}},{selector:"[data-hook=mapping]",type:"value"}]},events:e({},f.prototype.events,{"click [data-hook=value]":"_toggle"}),_toggle:function(){this.model.targetModel.toggle(this.model.targetProperty)}}),f.number=f.extend({_valueChange:function(){var a=this.model,b=a.targetModel,c=parseInt(this.queryByHook("value").value.trim()||0,10);b[a.targetProperty]!==c&&(b[a.targetProperty]=c)},template:'<div class="prop columns"><span class="column no-grow gutter-right"><button name="to-multi-mapping" class="vfi-attach"></button></span><strong class="prop-name column gutter-horizontal"></strong><span class="column columns"><span class="column no-grow gutter-horizontal"><button name="default-value" class="vfi-trash-empty"></button></span><input type="number" class="column gutter-left" placeholder="Value" data-hook="value" /></span><span class="column columns mapping"><input type="text" class="column gutter-right" placeholder="Events" data-hook="mapping" /><span class="column gutter-left no-grow"><button name="clear-mapping" class="vfi-trash-empty"></button></span></span></div>'}),f.range=f.number.extend({min:0,max:100,_valueChange:function(){var a=this.model,b=this.min,c=this.max,d=a.targetModel,e=parseInt(this.queryByHook("value").value.trim()||0,10);e=b>e?b:e>c?c:e,d[a.targetProperty]!==e&&(d[a.targetProperty]=e)},template:function(){return'<div class="prop columns"><span class="column no-grow gutter-right"><button name="to-multi-mapping" class="vfi-attach"></button></span><strong class="prop-name column gutter-horizontal"></strong><span class="column columns"><span class="column no-grow gutter-horizontal"><button name="default-value" class="vfi-trash-empty"></button></span><input type="number" min="'+this.min+'" max="'+this.max+'" class="column gutter-left" placeholder="Value" data-hook="value" /></span><span class="column columns mapping"><input type="text" class="column gutter-right" placeholder="Events" data-hook="mapping" /><span class="column gutter-left no-grow"><button name="clear-mapping" class="vfi-trash-empty"></button></span></span></div>'}}),f.red=f.green=f.blue=f.range.extend({min:0,max:255}),f.hue=f.rotateX=f.rotateY=f.rotateZ=f.range.extend({min:0,max:360}),f.shadowBlur=f.range.extend({min:0,max:50}),f.scaleX=f.scaleY=f.range.extend({min:-200,max:200}),f.translateX=f.translateY=f.shadowOffsetX=f.shadowOffsetY=f.range.extend({min:-100,max:100}),f.alpha=f.opacity=f.lightness=f.saturation=f.range.extend({}),b.exports=f},{}],21:[function(a,b,c){"use strict";var d=a("./state"),e=a("./../mappable/control-view"),f=VFDeps.View.extend({template:'<section class="row rows"><header class="row"><h3>Multi mapping</h3></header><div class="row mappings props"></div></section>',collections:{mappings:d.Collection},subviews:{mappingsView:{selector:".mappings",prepareView:function(a){return this.renderCollection(this.mappings,function(a){var b=a.model.definition.type,c=a.model.targetProperty,d=e[c]||e[b]||e;return console.info("multi mapping property name: %s (%s), type: %s (%s)",c,!!e[c],b,!!e[b]),new d(a)},a)}}}});b.exports=f},{"./../mappable/control-view":20,"./state":22}],22:[function(a,b,c){"use strict";var d=VFDeps.State,e=VFDeps.Collection,f={};f.toggleProp=function(a,b,c){return!c[b.targetProperty]};var g=d.extend({id:"targetProperty",props:{type:["string",!1,null],value:["any",!1,null],eventNames:["string",!0,""],targetProperty:["string",!0,""]},derived:{targetModel:{deps:["collection","collection.parent"],fn:function(){return this.collection.parent}},observedModel:{deps:["targetModel","targetModel.collection","targetModel.collection.parent"],fn:function(){return this.targetModel.collection.parent}},definition:{deps:["targetProperty","targetModel"],fn:function(){return this.targetModel.constructor.prototype._definition[this.targetProperty]}}},applyValue:function(a){var b=a;"undefined"!=typeof this.value&&null!==this.value&&(b=this.value);var c=this.type;"string"==typeof c&&(c=f[c]),"function"==typeof c&&(b=c(a,this,this.targetModel)),this.targetModel.set(this.targetProperty,b)},delegateMappingEvents:function(){var a=this.previousAttributes().eventNames;a&&this.stopListening(this.observedModel,a),this.eventNames&&this.observedModel&&this.listenTo(this.observedModel,this.eventNames,this.applyValue)},initialize:function(){this.delegateMappingEvents(),this.on("change:eventNames",this.delegateMappingEvents)}}),h=e.extend({mainIndex:"targetProperty",comparator:"targetProperty",model:function(a,b){var c=new g(a,b);return b.init===!1&&c.initialize(),c},serialize:function(){return this.map(function(a){return a.serialize()})}}),i=d.extend({initialize:function(){this.fillCollection()},fillCollection:function(){var a=this.mappings,b=Object.keys(this.constructor.prototype._definition).filter(function(a){return["type","name"].indexOf(a)<0});return b.forEach(function(b){a.get(b)||a.add({targetProperty:b})}),this},derived:{propDefaults:{fn:function(){var a,b={},c=this.constructor.prototype._definition;for(a in c)b[a]=c[a]["default"];return b}}},serialize:function(a){a=a||{};var b,c=d.prototype.serialize.call(this,a),e=this.propDefaults,f={};for(b in c)"mappings"===b||"undefined"!=typeof e[b]&&c[b]===e[b]||(f[b]=c[b]);return a.mappings&&(f.mappings=c.mappings),c},collections:{mappings:h}});i.State=g,i.Collection=h,b.exports=i},{}],23:[function(a,b,c){"use strict";function d(a){return 100/127*(a||0)}function e(a,b,c,e){if(!a[b])return c;if(192===e[0]){if("velocity"===b)return d(e[1]);if("note"===b)return"bpmKnob"}var f=a[b][""+c];return f?"function"==typeof f?f(e[0],e[1],e[2]):"velocity"===b?d(c):f:"velocity"===b?d(c):c}function f(a,b){function c(){b.set({signalType:"",signalNote:"",signalVelocity:""})}return function(d){if(!b.active)return c();var f=d.data,g=f[0]||0;if(248!==g){var h=f[1]||0,i=f[2]||0,j={signalType:e(b.midiMapping,"type",g,f),signalNote:e(b.midiMapping,"note",h,f),signalVelocity:e(b.midiMapping,"velocity",i,f)};248===j.type&&console.info("248",j.signalNote,j.signalVelocity);var k=b.midiMapping.prefix+":"+j.signalNote+":"+j.signalType;a.trigger("midi",k,j.signalVelocity),b.set(j)}}}function g(){var a=[];return this.forEach(function(b){a=a.concat(b.signalNames)}),a}var h=window.VFDeps,i=h.State,j=h.Collection,k=[49,50,51,52,53,54,55,56,92,95],l=[36,37,38,39],m={prefix:"kp3",type:{128:"noteOn",144:"noteOff",176:"change",192:"search",248:"idle"},note:{36:"buttonA",37:"buttonB",38:"buttonC",39:"buttonD",49:"num1",50:"num2",51:"num3",52:"num4",53:"num5",54:"num6",55:"num7",56:"num8",70:"padX",71:"padY",72:"pad72",73:"pad73",74:"pad74",75:"pad75",76:"pad76",92:"pad",93:"effectSlider",94:"effectKnob",95:"hold"},velocity:{0:function(a,b,c){return k.indexOf(b)>-1?!1:c},64:function(a,b,c){return l.indexOf(b)>-1?!1:d(c)},100:function(a,b,c){return l.indexOf(b)>-1?!0:d(c)},127:function(a,b,c){return k.indexOf(b)>-1?!0:d(c)}},signalNames:["buttonA:noteOn","buttonA:noteOff","buttonB:noteOn","buttonB:noteOff","buttonC:noteOn","buttonC:noteOff","buttonD:noteOn","buttonD:noteOff","num1:noteOn","num1:noteOff","num2:noteOn","num2:noteOff","num3:noteOn","num3:noteOff","num4:noteOn","num4:noteOff","num5:noteOn","num5:noteOff","num6:noteOn","num6:noteOff","num7:noteOn","num7:noteOff","num8:noteOn","num8:noteOff","pad:noteOn","pad:noteOff","padX:change","padY:change","pad72:change","pad73:change","pad74:change","pad75:change","pad76:change","effectKnob:change","effectSlider:change"]},n={"KP3 MIDI 1":{"ALSA library version 1.0.25":m}},o=i.extend({props:{connection:"string",state:"string",type:"string",id:"string",manufacturer:"string",name:"string",version:"string"},session:{active:["boolean",!0,!0]},derived:{midiMapping:{deps:["name","type","version"],fn:function(){var a=n||{};if(a[this.name]&&a[this.name][this.version])return a[this.name][this.version]}},signalNames:{deps:["midiMappings"],fn:function(){var a=this.midiMapping.prefix;return this.midiMapping.signalNames.map(function(b){return a+":"+b})}}}}),p=i.extend({initialize:function(a){function b(){if(!c.MIDIAccess)return c.inputs.reset([]),void c.outputs.reset([]);var a,b=[],d=[];c.MIDIAccess.inputs.forEach(function(d){a=new o({connection:d.connection,state:d.state,type:d.type,id:d.id,manufacturer:d.manufacturer,name:d.name,version:d.version}),a.midiMapping&&("undefined"!=typeof d.onmidimessage&&(d.onmidimessage=f(c,a)),b.push(a))}),c.MIDIAccess.outputs.forEach(function(b){a=new o({connection:b.connection,state:b.state,type:b.type,id:b.id,manufacturer:b.manufacturer,name:b.name,version:b.version}),a.midiMapping&&d.push(a)}),c.inputs.reset(b),c.outputs.reset(d)}a=a||{};var c=this;if(c.on("change:MIDIAccess",b),"undefined"==typeof a.MIDIAccess){if(!navigator.requestMIDIAccess)return console.warn("No WebMIDI API support"),void(c.MIDIAccess=!1);navigator.requestMIDIAccess().then(function(a){c.MIDIAccess=a,c.MIDIAccess.onstatechange=function(a){c.MIDIAccess=a.currentTarget,b()}},function(){c.MIDIAccess=!1})}},session:{MIDIAccess:{type:"any","default":!1}},collections:{inputs:j.extend({signalNames:g,model:o}),outputs:j.extend({model:o})},toJSON:function(){var a={};return a.inputs=this.inputs.toJSON(),a.outputs=this.outputs.toJSON(),a},derived:{signalNames:{deps:["inputs"],fn:function(){return this.inputs.signalNames()}}}});b.exports=p},{}],24:[function(a,b,c){"use strict";var d=window.VFDeps,e=d.View,f=e.extend({template:['<li class="gutter">','<span class="name"></span> ',"</li>"].join(""),bindings:{"model.active":{type:"booleanClass"},"model.state":".state","model.name":".name"},events:{click:"_handleClick"},_handleClick:function(){this.model.toggle("active")}}),g=e.extend({template:'<div class="midi-access"><div class="midi-inputs"><div class="gutter">Inputs</div><ul></ul></div></div>',render:function(){var a;return this.el&&(a=this.el.className),this.renderWithTemplate(),a&&(this.el.className=a),this.inputsView=this.renderCollection(this.model.inputs,f,".midi-inputs ul"),this}});b.exports=g},{}],25:[function(a,b,c){"use strict";var d=VFDeps.State,e=VFDeps.Collection,f=a("./../layer/state");a("./../layer/canvas/state"),a("./../layer/video/state"),a("./../layer/svg/state"),a("./../layer/img/state");var g=a("./../signal/state");a("./../signal/beat/state"),a("./../signal/hsla/state"),a("./../signal/rgba/state");var h=d.extend({initialize:function(){this.on("change:frametime",function(){this.trigger("frametime",this.frametime)})},props:{audioMinDb:["number",!0,-90],audioMaxDb:["number",!0,-10],audioSmoothing:["number",!0,.85],audioFftSize:["number",!0,256],frametime:["number",!0,0],firstframetime:["any",!0,function(){return performance.now()}],signals:["object",!0,function(){return{}}]},collections:{screenLayers:e.extend({comparator:"zIndex",mainIndex:"name",model:function(a,b){var c=f[a.type]||f,d=new c(a,b);return d.on("change:zIndex",function(){d.collection.sort()}),d}}),screenSignals:e.extend({mainIndex:"name",model:function(a,b){var c=g[a.type]||g;return new c(a,b)}})},session:{latency:["number",!0,0]}});b.exports=h},{"./../layer/canvas/state":9,"./../layer/img/state":12,"./../layer/state":14,"./../layer/svg/state":15,"./../layer/video/state":17,"./../signal/beat/state":28,"./../signal/hsla/state":32,"./../signal/rgba/state":34,"./../signal/state":35}],26:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=a("./../layer/view");a("./../layer/canvas/view"),a("./../layer/svg/view"),a("./../layer/video/view"),a("./../layer/img/view");var f=d.extend({autoRender:!0,template:'<div class="screen"></div>',derived:{inactive:{deps:["mode","controlScreenDeactivated"],fn:function(){return"control"===this.mode&&this.controlScreenDeactivated}},signalNames:{deps:["screenSignals","MIDIAccess"],fn:function(){var a=[];if(this.audioAnalyser)for(var b=0;b<this.audioAnalyser.frequencyBinCount;b++)a.push("mic:"+b);var c=this.model.screenSignals.map(function(a){return a.name}).concat(this.MIDIAccess?this.MIDIAccess.signalNames:[],a);return c}}},session:{controlScreenDeactivated:["boolean",!0,!1],width:["number",!0,400],height:["number",!0,300],broadcastId:["string",!0,"vfBus"],ratio:{type:"number",required:!0,"default":4/3,values:[0,4/3,16/9]},MIDIAccess:"state",captureMouse:["boolean",!0,!1],captureDebug:["boolean",!0,!1],mode:{type:"string",required:!0,"default":"screen",values:["screen","control"]}},bindings:{inactive:{type:"toggle",invert:!0}},execCommand:function(a,b,c){this.inactive||("update"===a?(b.latency=performance.now()-c,this.update(b)):"resize"===a&&this.resize())},initialize:function(){var a=this;if(!a.model)throw new Error("Missing model option for ScreenView");if(window.BroadcastChannel){var b=a.channel=new window.BroadcastChannel(this.broadcastId);b.onmessage=function(b){a.execCommand(b.data.type,b.data.data,b.timeStamp)}}},remove:function(){return this.channel&&this.channel.close(),d.prototype.remove.apply(this,arguments)},resize:function(a){if(!this.el)return this;if("screen"===this.mode)return this.el.style.position="fixed",this.el.top=0,this.el.left=0,this.el.style.width="100%",this.el.style.height="100%",this.width=this.el.clientWidth,this.height=this.el.clientHeight,this.resizeLayers();if(a=a||this.el.parentNode,a&&a.clientWidth){this.width=a.clientWidth;var b=this.ratio||4/3;this.height=Math.floor(this.width/b),this.el.style.width=this.width+"px",this.el.style.height=this.height+"px"}return this.resizeLayers()},resizeLayers:function(){if(!this.layersView||!this.layersView.views)return this;var a=this.width,b=this.height;return this.layersView.views.forEach(function(c){c.width=a,c.height=b}),this},render:function(){return this.renderWithTemplate(),this.layersView=this.renderCollection(this.model.screenLayers,function(a){var b=a.model.getType(),c=e[b]||e;return new c(a)},this.el,{parent:this}),this.resize()},update:function(a){function b(a){return function(b){return b.name===a}}if(!this.layersView)return this.render().update(a);this.model.set(a);var c,d=this.model.screenLayers;return a.screenLayers&&(a.screenLayers.forEach(function(a){c=!0;var b=d.get(a.name);b?b.set(a,{silent:!0}):d.add(a,{silent:!0})}),d.forEach(function(e){var f=a.screenLayers.find(b(e.name));f||(c=!0,d.remove(e,{silent:!0}))}),c&&this.trigger("change:screenLayers",d)),this.layersView.views.forEach(function(a){a.update()}),this}});b.exports=f},{"./../layer/canvas/view":10,"./../layer/img/view":13,"./../layer/svg/view":16,"./../layer/video/view":18,"./../layer/view":19}],27:[function(a,b,c){"use strict";var d=window.VFDeps.assign,e=a("./../control-view"),f=e.beatSignal=e.extend({template:'<section class="rows signal signal-beat"><header class="row"><h3 class="name"></h3></header><div class="row columns gutter-horizontal gutter-bottom"><div class="column result-dot no-grow gutter-right"></div><div class="column result gutter-left"><input class="column input" placeholder="BPM" data-hook="input" /></div></div><div class="row mappings props"></div></section>',bindings:d({},e.prototype.bindings,{"model.result":[{selector:".result-dot",type:function(a,b){a.style.backgroundColor="hsla(190, 81%, 67%,"+b/100+")"}}]}),events:d({},e.prototype.events,{"change [data-hook=input]":"_updateBPM"}),_updateBPM:function(){this.model.input=parseInt(this.queryByHook("input").value.trim(),10),console.info("Changing BPM",this.model.input)},render:function(){this.renderWithTemplate();var a=this.queryByHook("input");return a&&!a.value&&(a.value=this.model.input),this}});b.exports=f},{"./../control-view":29}],28:[function(a,b,c){"use strict";var d=a("./../state"),e=d.beatSignal=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments);var a=this;this.collection.parent.on("change:frametime",function(b,c){a._ft=c})},session:{_ft:["number",!0,0]},derived:{result:{deps:["timeBetweenBeats","_ft"],fn:function(){return this.computeSignal()}},timeBetweenBeats:{deps:["input"],fn:function(){return 6e4/Math.max(this.input,1)}}},computeSignal:function(){var a=this._ft,b=a?100-a%this.timeBetweenBeats/this.timeBetweenBeats*100:0,c=d.prototype.computeSignal.apply(this,[b]);return c}});b.exports=e},{"./../state":35}],29:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=a("./details-view"),f=d.extend({template:'<section class="rows signal"><header class="row"><h3 class="row name"></h3></header><div class="row gutter-horizontal columns test text-center"><input class="column input" placeholder="Input" type="text"/><div class="column gutter-horizontal no-grow">&raquo;</div><div class="column result"></div></div></section>',session:{input:"any",showMappings:["boolean",!0,!1]},derived:{rootView:{deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}},result:{deps:["input","model","model.transformations"],fn:function(){return this.model.computeSignal(this.input)}}},bindings:{"model.name":".name",result:".test .result"},events:{"change .test .input":"_testValue","click header h3":"_showDetails"},_showDetails:function(){this.rootView.showDetails(new e({parent:this,model:this.model}))},_testValue:function(a){this.input=a.target.value.trim()},render:function(){this.renderWithTemplate();var a=this.query(".test .input");return a&&!a.value&&(a.value=this.input||null),this}});b.exports=f},{"./details-view":30}],30:[function(a,b,c){"use strict";var d=window.VFDeps.assign,e=a("./../controller/details-view"),f=a("./../transformation/control-view"),g=a("./../transformation/functions"),h=e.extend({template:'<section><header><h3>Details for <span data-hook="name"></span></h3></header><div class="row mappings props"></div><div class="row gutter transformations-control columns"><input class="column gutter-right" placeholder="New transformation" data-hook="new-transformation-name" type="text"/><div class="column gutter-left no-grow"><button name="add-transformation" class="vfi-plus"></button></div></div><div class="row transformations props"></div></section>',subviews:d({},e.prototype.subviews,{transformationsView:{selector:".transformations",prepareView:function(a){return this.renderCollection(this.model.transformations,f,a)}}}),events:{"click [name=add-transformation]":"_addTransformation","focus [data-hook=new-transformation-name]":"_focusName"},derived:{rootView:{deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}}},_focusName:function(){var a=this.queryByHook("new-transformation-name"),b=this.rootView.suggestionHelper;a.select(),b.attach(a,function(c){a.value=c,b.detach()}).fill(Object.keys(g))},_addTransformation:function(){this.model.transformations.add({name:this.queryByHook("new-transformation-name").value.trim()})},bindings:d({"model.name":"[data-hook=name]"},e.prototype.bindings)});b.exports=h},{"./../controller/details-view":4,"./../transformation/control-view":36,"./../transformation/functions":37}],31:[function(a,b,c){"use strict";var d=window.VFDeps.assign,e=a("./../control-view"),f=e.hslaSignal=e.extend({template:['<section class="rows signal signal-color">','<header class="row">','<h3 class="name"></h3>',"</header>",'<div class="row columns gutter-horizontal gutter-bottom">','<div class="column result-color no-grow"></div>','<div class="column result gutter-left"></div>',"</div>",'<div class="row mappings props"></div>',"</section>"].join(""),bindings:d({},e.prototype.bindings,{"model.result":[{selector:".result-color",type:function(a,b){a.style.backgroundColor=b}},{selector:".result",type:"text"}]})});b.exports=f},{"./../control-view":29}],32:[function(a,b,c){"use strict";var d=a("./../state"),e={type:"number",required:!0,"default":180,min:0,max:360},f={type:"number",required:!0,"default":100,min:0,max:100},g=d.hslaSignal=d.extend({session:{hue:e,saturation:f,lightness:f,alpha:f},derived:{result:{deps:["hue","saturation","lightness","alpha"],fn:function(){return this.computeSignal()}}},computeSignal:function(){return"hsla("+Math.round(this.hue)+","+Math.round(this.saturation)+"%,"+Math.round(this.lightness)+"%,"+Math.round(this.alpha)/100+")"}});b.exports=g},{"./../state":35}],33:[function(a,b,c){"use strict";var d=a("./../control-view"),e=a("./../hsla/control-view"),f=d.rgbaSignal=e.extend({});b.exports=f},{"./../control-view":29,"./../hsla/control-view":31}],34:[function(a,b,c){"use strict";var d=a("./../state"),e={type:"number",required:!0,"default":180,min:0,max:255},f={type:"number",required:!0,"default":100,min:0,max:100},g=d.rgbaSignal=d.extend({session:{red:e,green:e,blue:e,alpha:f},derived:{result:{deps:["red","green","blue","alpha"],fn:function(){
return this.computeSignal()}}},computeSignal:function(){return"rgba("+Math.round(this.red)+","+Math.round(this.green)+","+Math.round(this.blue)+","+Math.round(this.alpha)/100+")"}});b.exports=g},{"./../state":35}],35:[function(a,b,c){"use strict";var d=window.VFDeps.State,e=window.VFDeps.Collection,f=a("./../mappable/state"),g=a("./../transformation/functions"),h=d.extend({props:{name:["string",!0,null],arguments:["array",!0,function(){return[]}]}}),i=f.extend({idAttribute:"name",typeAttribute:"type",initialize:function(){this.on("change:result",function(){this.collection.parent.trigger(this.name,this.result)}),(null===this.input||void 0===this.input)&&(this.input=this.defaultValue)},props:{name:["string",!0,null],type:["string",!0,"default"],defaultValue:["any",!0,function(){return 1}],input:["any",!1,null]},collections:{transformations:e.extend({model:h})},derived:{result:{deps:["input","transformations"],fn:function(){return this.computeSignal()}}},computeSignal:function(a){return a=a||this.input,this.transformations.forEach(function(b){var c=[a].concat(b.arguments);a=g[b.name].apply(this,c)}),a}});b.exports=i},{"./../mappable/state":22,"./../transformation/functions":37}],36:[function(a,b,c){"use strict";var d=window.VFDeps.View,e=d.extend({template:'<div class="transformation gutter columns"><div class="column gutter-right text-right" data-hook="name"></div><div class="column gutter-horizontal no-grow"><button name="remove" class="vfi-trash-empty"></button></div><input class="column gutter-left" data-hook="arguments" type="text"/></div>',derived:{rootView:{deps:["parent"],fn:function(){for(var a=this;a;a=a.parent)if(!a.parent)return a}},arguments:{deps:["model","model.arguments"],fn:function(){return(this.model.arguments||[]).join(",")}}},parseArguments:function(a){var b=this.model;a=(a||this.queryByHook("arguments").value).trim();var c=0===b.name.indexOf("math."),d=a.split(",").map(function(a){return a=c?Number(a):a,a=c&&isNaN(a)?0:a});this.model.arguments=d},bindings:{"model.name":"[data-hook=name]","model.arguments":{hook:"arguments",type:function(a){a!==document.activeElement&&(a.value=this.model.arguments.join(","))}}},events:{"click [name=remove]":"_remove","keyup [data-hook=arguments]":"_changeArguments"},_remove:function(){this.model.collection.remove(this.model)},_changeArguments:function(){this.parseArguments()}});b.exports=e},{}],37:[function(a,b,c){"use strict";var d={};d["math.multiply"]=function(a,b){return a*b},d["math.add"]=function(a,b){return a+b},d["math.subtract"]=function(a,b){return a-b},d["math.modulo"]=function(a,b){return a%b},d["math.above"]=function(a,b){return a>b},d["math.aboveOrEqual"]=function(a,b){return a>=b},d["math.below"]=function(a,b){return b>a},d["math.belowOrEqual"]=function(a,b){return b>=a},d["math.within"]=function(a,b,c){return c>=a&&a>=b},Object.getOwnPropertyNames(Math).forEach(function(a){"constructor"!==a&&"function"==typeof Math[a]&&(d["math."+a]=Math[a])});var e="".constructor.prototype;Object.getOwnPropertyNames(e).forEach(function(a){"constructor"!==a&&"function"==typeof e[a]&&(d["string."+a]=function(b){var c=[].slice.apply(arguments).slice(1);e[a].apply(b,c)})}),d["string.toBool"]=function(a){return!(!a||"false"===a||"null"===a)},d["string.toInteger"]=function(a){return parseInt(a,10)},d["string.toFloat"]=function(a){return parseFloat(a)},d["string.toNumber"]=function(a){return Number(a)},b.exports=d},{}]},{},[1]);