{"version":3,"sources":["webpack:///./signal/collection.js","webpack:///./signal/hsla/state.js","webpack:///./signal/programmable/state.js","webpack:///./signal/rgba/state.js","webpack:///./utils/compile-function.js","webpack:///./signal/state.js"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,CAAC;AACD;;;;;;;;;ACtCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,CAAC;;AAED,iC;;;;;;;;AC9EA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA,kJAAkJ,WAAW;AAC7J,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,E;;;;;;;;ACrED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,CAAC;AACD,iC;;;;;;;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;;;;;;;;ACrBA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,6CAA6C,UAAU,EAAE;AACzD,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,sEAAsE,iBAAiB;AACvF,KAAK;;AAEL;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,CAAC;;AAED;;AAEA","file":"3.worker-build.js","sourcesContent":["'use strict';\nvar Collection = require('ampersand-collection');\nvar SignalState = require('./state');\nrequire('./programmable/state');\nrequire('./hsla/state');\nrequire('./rgba/state');\n\nvar SignalCollection = Collection.extend({\n  mainIndex: 'name',\n\n  clock: null,\n  audio: null,\n  worker: null,\n\n  model: function(attrs, opts) {\n    var Constructor = SignalState.types[attrs.type] || SignalState;\n    var state = new Constructor(attrs, opts);\n    return state;\n  },\n\n  initialize: function(models, options) {\n    this.location = typeof DedicatedWorkerGlobalScope !== 'undefined' ? 'worker' : 'controller';\n    this.clock = options.clock;\n    this.audio = options.audio;\n    this.emitCommand = options.emitCommand;\n  },\n\n  toJSON: function () {\n    return this.map(function (model) {\n      if (model.toJSON) {\n        return model.toJSON();\n      }\n      else {\n        return model;\n      }\n    });\n  }\n});\nmodule.exports = SignalCollection;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./signal/collection.js\n// module id = 3\n// module chunks = 3","'use strict';\nvar SignalState = require('./../state');\n\nfunction _360(name) {\n  return {\n    name: name,\n    type: 'number',\n    default: 180,\n    min: 0,\n    max: 360\n  };\n}\nfunction _100(name) {\n  return {\n    name: name,\n    type: 'number',\n    default: 100,\n    min: 0,\n    max: 100\n  };\n}\nfunction _1(name) {\n  return {\n    name: name,\n    type: 'number',\n    default: 1,\n    min: 0,\n    max: 1\n  };\n}\nfunction derivedParameter(name) {\n  return {\n    deps: ['parameters.' + name],\n    fn: function() {\n      return this.parameters.getValue(name);\n    }\n  };\n}\n\nvar HSLASignalState = SignalState.types.hsla = SignalState.extend({\n  baseParameters: [\n    _360('hue'),\n    _100('saturation'),\n    _100('lightness'),\n    _1('alpha')\n  ],\n\n  mappable: {\n    source: ['result', 'hue', 'saturation', 'lightness', 'alpha'],\n    target: ['parameters']\n  },\n\n  derived: {\n    hue: derivedParameter('hue'),\n    saturation: derivedParameter('saturation'),\n    lightness: derivedParameter('lightness'),\n    alpha: derivedParameter('alpha'),\n    result: {\n      deps: ['hue', 'saturation', 'lightness', 'alpha'],\n      fn: function() {\n        return this.computeSignal();\n      }\n    }\n  },\n  // parseInput: function() {\n  //   var values = _colorValues(this.input);\n  //   return {\n  //     hue: values[0],\n  //     saturation: values[1],\n  //     lightness: values[2],\n  //     alpha: values[3]\n  //   };\n  // },\n  computeSignal: function() {\n    return 'hsla(' + Math.round(this.hue) + ',' + Math.round(this.saturation) + '%,' + Math.round(this.lightness) + '%,' + (Math.round(100 * this.alpha) / 100) + ')';\n  }\n});\n\nmodule.exports = HSLASignalState;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./signal/hsla/state.js\n// module id = 303\n// module chunks = 3","'use strict';\nvar compileFunction = require('./../../utils/compile-function');\nvar SignalState = require('./../state');\n\nvar updatePrologue = ``;\n\nmodule.exports = SignalState.types.programmable = SignalState.extend({\n  initialize: function() {\n    SignalState.prototype.initialize.apply(this, arguments);\n\n    // this forces the refresh of 'result' derived on worker everytime the clock is ticking\n    if (this.location !== 'worker') return;\n    this.listenTo(this.collection.clock, 'change:frametime', function() {\n      delete this._cache.result;\n      this.trigger('change:input');\n    });\n  },\n\n  props: {\n    updateFunction: ['string', true, 'console.info(\"frametime %s, bpm %s, beatnum %s, beatprct %s\", frametime, bpm, beatnum, beatprct.toFixed(2));\\nreturn 0;']\n  },\n\n  derived: {\n    result: {\n      deps: ['input', 'workerResult'],\n      fn: function() {\n        if (this.location !== 'worker') return this.workerResult || this.defaultValue;\n        return this.computeSignal();\n      }\n    },\n    updateFn: {\n      deps: ['updateFunction'],\n      fn: function() {\n        return compileFunction(\n          'update',\n          updatePrologue,\n          'frametime',\n          'bpm',\n          'beatnum',\n          'beatprct',\n          this.updateFunction\n        );\n      }\n    }\n  },\n\n  computeSignal: function(clock) {\n    clock = clock || (this.collection ? this.collection.clock : {\n      frametime: 0,\n      bpm: 120,\n      beatnum: 0,\n      beatprct: 0,\n    });\n\n    var fn = this.updateFn;\n    var result = 0;\n    try {\n      result = fn(\n        clock.frametime,\n        clock.bpm,\n        clock.beatnum,\n        clock.beatprct\n      );\n    }\n    catch (err) {\n      console.warn('Error', err.message);\n    }\n    return result;\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./signal/programmable/state.js\n// module id = 304\n// module chunks = 3","'use strict';\nvar SignalState = require('./../state');\nfunction _255(name) {\n  return {\n    name: name,\n    type: 'number',\n    default: 180,\n    min: 0,\n    max: 255\n  };\n}\nfunction _1(name) {\n  return {\n    name: name,\n    type: 'number',\n    default: 1,\n    min: 0,\n    max: 1\n  };\n}\nfunction derivedParameter(name) {\n  return {\n    deps: ['parameters.' + name],\n    fn: function() {\n      return this.parameters.getValue(name);\n    }\n  };\n}\n\nvar RGBASignalState = SignalState.types.rgba = SignalState.extend({\n  baseParameters: [\n    _255('red'),\n    _255('green'),\n    _255('blue'),\n    _1('alpha')\n  ],\n\n  mappable: {\n    source: ['result', 'red', 'green', 'blue', 'alpha'],\n    target: ['parameters']\n  },\n\n  derived: {\n    red: derivedParameter('red'),\n    green: derivedParameter('green'),\n    blue: derivedParameter('blue'),\n    alpha: derivedParameter('alpha'),\n    result: {\n      deps: ['red', 'green', 'blue', 'alpha'],\n      fn: function() {\n        return this.computeSignal();\n      }\n    }\n  },\n  // parseInput: function() {\n  //   var values = _colorValues(this.input);\n  //   return {\n  //     red: values[0],\n  //     green: values[1],\n  //     blue: values[2],\n  //     alpha: values[3]\n  //   };\n  // },\n  computeSignal: function() {\n    return 'rgba(' + Math.round(this.red) + ',' + Math.round(this.green) + ',' + Math.round(this.blue) + ',' + (Math.round(100 * this.alpha) / 100) + ')';\n  }\n});\nmodule.exports = RGBASignalState;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./signal/rgba/state.js\n// module id = 305\n// module chunks = 3","'use strict';\n/**\n * compileFunction(name, prologue, [arg1, arg2, ...] body)\n */\nmodule.exports = function compileFunction(...args) {\n  var name = args.shift();\n  var prologue = args.shift();\n  var body = args.pop();\n  var fn;\n\n  console.time('compileFunction ' + name);\n  try {\n    fn = new Function(...args, prologue + body);// jshint ignore:line\n    if (typeof fn !== 'function') throw new Error('Function compilation error, returned not function');\n  }\n  catch (e) {\n    console.log('%c compilation error: %s', 'color:red', e.message);\n    fn = e;\n  }\n  console.timeEnd('compileFunction ' + name);\n  return fn;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./utils/compile-function.js\n// module id = 306\n// module chunks = 3","'use strict';\n\nvar parameterizedState = require('./../parameter/mixin');\nvar SignalState = parameterizedState([]).extend({\n  idAttribute: 'name',\n  typeAttribute: 'type',\n\n  mappable: {\n    source: ['result'],\n    target: ['parameters']\n  },\n\n  props: {\n    name: ['string', true, null],\n    type: ['string', true, 'default'],\n    defaultValue: ['any', true, function () { return 1; }]\n  },\n\n  session: {\n    workerResult: ['any', false, null]\n  },\n\n  derived: {\n    modelPath: {\n      deps: ['name'],\n      fn: function() {\n        return 'signals.' + this.name;\n      }\n    },\n    location: {\n      deps: [],\n      fn: function() {\n        return this.collection.location;\n      }\n    },\n    result: {\n      deps: ['input', 'workerResult'],\n      fn: function() {\n        return this.location !== 'worker' ?\n          (this.workerResult || this.defaultValue) :\n          this.computeSignal();\n      }\n    }\n  },\n\n\n  initialize: function() {\n    var signal = this;\n    var id = signal.getId();\n    var signals = signal.collection;\n    if (!signal.collection) throw new Error('Missing collection for ' + signal.name);\n\n    signal._ensureBaseParameters();\n\n    signal.listenTo(signal.parameters, 'change', function() {\n      signal.trigger('change:parameters', signal, signal.parameters, {parameters: true});\n    });\n\n    if (signal.location === 'worker') {\n      signal.on('change:result', function() {\n        if (signals !== signal.collection) return; // may happen when bootstraping a new setup\n        signals.emitCommand('updateSignalResult', {\n          name: id,\n          workerResult: signal.result\n        });\n      });\n    }\n    else {\n      signal.on('change:workerResult', function() {\n        signal.trigger('change:result', signal, signal.result);\n      });\n    }\n  },\n\n  computeSignal: function(val) {\n    val = val || this.input;\n    return val;\n  }\n});\n\nSignalState.types = {};\n\nmodule.exports = SignalState;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./signal/state.js\n// module id = 7\n// module chunks = 3"],"sourceRoot":""}