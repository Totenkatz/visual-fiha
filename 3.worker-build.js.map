{"version":3,"sources":["webpack:///./screen/state.js","webpack:///./layer/collection.js","webpack:///./screen/clock.js"],"names":[],"mappings":";;;;;;AAAA;AACA;;AAEA;AACA;AACA,+CAA+C;AAC/C;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA,wCAAwC;AACxC;AACA;AACA;AACA,MAAM,EAAE;AACR;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;;;;;;;;;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,CAAC,E;;;;;;;;ACrCD;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED,uB","file":"3.worker-build.js","sourcesContent":["'use strict';\n/* global Uint8Array*/\n\nvar State = require('ampersand-state');\nvar ScreenState = State.extend({\n  initialize: function(attributes, options = {}) {\n    this._isControllerState = !!options.router;\n  },\n\n  mappable: {\n    source: ['midi', 'frametime', 'clock', 'signals'],\n    target: ['layers', 'signals', 'clock']\n  },\n\n  session: {\n    audio: ['object', true, function() { return {\n      bufferLength: 128,\n      frequency: new Uint8Array(128),\n      timeDomain: new Uint8Array(128)\n    }; }],\n    latency: ['number', true, 0]\n  },\n\n  children: {\n    clock: require('./clock')\n  },\n\n  collections: {\n    layers: require('./../layer/collection')\n  },\n\n  derived: {\n    frametime: {\n      deps: ['clock.frametime'],\n      fn: function() {\n        return this.clock.frametime;\n      }\n    },\n    hasDOM: {\n      deps: [],\n      fn: function() {\n        return typeof DedicatedWorkerGlobalScope === 'undefined';\n      }\n    },\n    isControllerState: {\n      deps: [],\n      fn: function() {\n        return this._isControllerState;\n      }\n    },\n    location: {\n      deps: ['hasDOM', 'isControllerState'],\n      fn: function() {\n        return this.isControllerState ? 'control' : (this.hasDOM ? 'screen' : 'worker');\n      }\n    }\n  },\n\n  _log: function(...args) {\n    var color = this.location === 'screen' ? 'lightblue' : (this.location === 'control' ? 'lightgreen' : 'pink');\n    var txt = args.shift();\n    console.log('%c'+ this.location[0].toUpperCase() + ': ' + txt, 'color:' + color, ...args);\n  },\n\n  toJSON: function() {\n    var obj = State.prototype.toJSON.apply(this, arguments);\n    delete obj.audio;\n    return obj;\n  }\n});\n\nmodule.exports = ScreenState;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./screen/state.js\n// module id = 2\n// module chunks = 3","'use strict';\nvar assign = require('lodash.assign');\nvar Collection = require('ampersand-collection');\nvar LayerState = require('./state');\nrequire('./canvas/state');\nrequire('./video/state');\nrequire('./svg/state');\nrequire('./img/state');\nrequire('./txt/state');\nrequire('./p5/state');\nrequire('./threejs/state');\n\nmodule.exports = Collection.extend({\n  comparator: 'zIndex',\n  mainIndex: 'name',\n  model: function(attrs, opts) {\n    var Constructor = LayerState.types[attrs.type] || LayerState;\n    var state = new Constructor(attrs, opts);\n    // state.on('change', function() {\n    //   opts.collection.trigger('change:layer', state);\n    // });\n    return state;\n  },\n\n  toJSON: function () {\n    return this.map(function (model) {\n      if (model.toJSON) {\n        return model.toJSON();\n      }\n      else {\n        var out = {};\n        assign(out, model);\n        delete out.collection;\n        return out;\n      }\n    });\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./layer/collection.js\n// module id = 297\n// module chunks = 3","'use strict';\nvar State = require('ampersand-state');\n\nvar Clock = State.extend({\n  mappable: {\n    source: ['frametime', 'pausetime', 'starttime', 'bpm', 'beatprct', 'beatnum', 'beatlength'],\n    target: ['beatdelay', 'bpm']\n  },\n\n  play: function() {\n    var now = Date.now();\n    this.starttime = this.pausetime ? this.starttime + (now - this.pausetime) : now;\n    this.pausetime = 0;\n    return this.refresh();\n  },\n\n  pause: function() {\n    this.pausetime = Date.now();\n    return this.refresh();\n  },\n\n  stop: function() {\n    var now = Date.now();\n    this.pausetime = now;\n    this.starttime = now;\n    this.frametime = 0;\n    return this;\n  },\n\n  refresh: function() {\n    if (this.playing) this.frametime = Date.now() - this.starttime;\n    return this;\n  },\n\n  derived: {\n    modelPath: {\n      deps: [],\n      fn: function() {\n        return 'clock';\n      }\n    },\n    playing: {\n      deps: ['pausetime'],\n      fn: function() {\n        return !this.pausetime;\n      }\n    },\n    paused: {\n      deps: ['pausetime', 'starttime'],\n      fn: function() {\n        return this.pausetime > this.starttime;\n      }\n    },\n    stopped: {\n      deps: ['pausetime', 'starttime'],\n      fn: function() {\n        return this.pausetime === this.starttime;\n      }\n    },\n    beatprct: {\n      deps: ['beatlength', 'frametime'],\n      fn: function() {\n        var ft = this.frametime;\n        var bl = this.beatlength;\n        return !ft ? 0 : (100 - (((ft % bl) / bl) * 100));\n      }\n    },\n    beatnum: {\n      deps: ['beatlength', 'beatdelay', 'frametime'],\n      fn: function() {\n        var ft = this.frametime + this.beatdelay;\n        return ft ? Math.floor(ft / this.beatlength) : 0;\n      }\n    },\n    beatlength: {\n      deps: ['bpm'],\n      fn: function() {\n        return (60 * 1000) / Math.max(this.bpm, 1);\n      }\n    }\n  },\n\n  props: {\n    pausetime: ['number', true, 0],\n    starttime: ['number', true, Date.now],\n    frametime: ['number', true, 0],\n    beatdelay: ['number', true, 0],\n    bpm: ['number', true, 120]\n  }\n});\n\nmodule.exports = Clock;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./screen/clock.js\n// module id = 300\n// module chunks = 3"],"sourceRoot":""}